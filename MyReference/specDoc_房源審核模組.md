# æˆ¿æºå¯©æ ¸æ¨¡çµ„

æœ¬æ¨¡çµ„è™•ç†æˆ¿æºçš„åˆŠç™»å¯©æ ¸æµç¨‹ï¼Œç¢ºä¿å¹³å°ä¸Šçš„æˆ¿æºè³‡è¨ŠçœŸå¯¦å¯é ã€‚æ‰€æœ‰ç›¸é—œé‚è¼¯åœç¹ä»¥ä¸‹æ ¸å¿ƒè³‡æ–™è¡¨ã€åŸå‰‡èˆ‡æµç¨‹ã€‚

### æ¶‰åŠä¸»è¡¨

-   **`properties`**: æˆ¿æºè³‡æ–™ä¸»è¡¨ã€‚
-   **`approvals`**: å¯©æ ¸æ¡ˆä»¶ä¸»è¡¨ï¼Œç‚ºä¸€å…±ç”¨è¡¨ï¼Œè™•ç†å¤šç¨®é¡å‹çš„å¯©æ ¸ã€‚
-   **`approvalItems`**: å¯©æ ¸æ¡ˆä»¶çš„è©³ç´°æ“ä½œæ­·ç¨‹è¨˜éŒ„ã€‚

### å¤§åŸå‰‡èˆ‡æ ¸å¿ƒè¨­è¨ˆ

1.  **å¯©æ ¸é¡å‹å€åˆ† (`approvals.moduleCode`)**: æˆ¿æºå¯©æ ¸ä½¿ç”¨ `moduleCode = 'PROPERTY'` é€²è¡Œè­˜åˆ¥ã€‚

2.  **æˆ¿æºç‹€æ…‹ç®¡ç†**: `properties` è¡¨ä¸­çš„ `statusCode` æ¬„ä½ç®¡ç†æˆ¿æºçš„å®Œæ•´ç‹€æ…‹ï¼š
    
    **å¯©æ ¸ç›¸é—œç‹€æ…‹**ï¼š
    -   `PENDING`: å¾…å¯©æ ¸ç‹€æ…‹ï¼Œæˆ¿æºå·²æäº¤ä½†æœªå¯©æ ¸å®Œæˆã€‚
    -   `ACTIVE`: å¯©æ ¸é€šéç‹€æ…‹ï¼Œä½†ä¸ä»£è¡¨å°å¤–å¯è¦‹ã€‚
    -   `REJECTED`: å¯©æ ¸æ‹’çµ•ï¼Œæˆ¿æºç„¡æ³•ä¸Šæ¶ã€‚
    -   `BANNED`: å› é•è¦è¢«ç®¡ç†å“¡å¼·åˆ¶ä¸‹æ¶ï¼Œéœ€é‡æ–°ç”³è«‹å¯©æ ¸ã€‚
    
    **æˆ¿æ±ç®¡ç†ç‹€æ…‹**ï¼š
    -   ç”±ç”¨æˆ¶ä»‹é¢è² è²¬é–‹ç™¼è€…å®šç¾©ï¼Œä¸å½±éŸ¿å¾Œå°åŠŸèƒ½å¯¦ä½œã€‚
    -   å¾Œå°ç®¡ç†å“¡ç„¡æ³•æ“ä½œé€™äº›ç‹€æ…‹ï¼Œåƒ…èƒ½çœ‹åˆ°ç‹€æ…‹åç¨±ã€‚
    
3.  **æˆ¿æºå¯è¦‹æ€§æ¢ä»¶**: æˆ¿æºå°å¤–å¯è¦‹ï¼ˆé¡¯ç¤ºæ–¼ç”¨æˆ¶ä»‹é¢ã€å¯è¢«æœå°‹åˆ°ï¼‰éœ€è¦åŒæ™‚æ»¿è¶³ï¼š
    -   **å¯©æ ¸é€šé**: `properties.statusCode = 'ACTIVE'`ï¼ˆå…¶ä»–ç‹€æ…‹å‡ä¸å¯è¦‹ï¼‰
    -   **ä»˜è²»æœ‰æ•ˆ**: `properties.isPaid = true` ä¸”ç•¶å‰æ™‚é–“æ—©æ–¼ `properties.expireAt`
    -   **éæš«åœç‹€æ…‹**: æ’é™¤ `BANNED` å’Œå…¶ä»–é `ACTIVE` ç‹€æ…‹

4.  **å¯©æ ¸å°è±¡è­˜åˆ¥**: 
    -   ç•¶å¯©æ ¸æˆ¿æºæ™‚ï¼Œ`approvals.sourcePropertyID` æ¬„ä½å„²å­˜è¢«å¯©æ ¸çš„æˆ¿æºIDã€‚
    -   `approvals.applicantMemberID` æ¬„ä½è¨˜éŒ„ç”³è«‹æˆ¿æ±çš„æœƒå“¡IDã€‚

5.  **å‰ç½®æ¢ä»¶é©—è­‰**: 
    -   åƒ…é™å·²é©—è­‰çš„æˆ¿æ± (`members.isLandlord = true`) æ‰èƒ½æäº¤æˆ¿æºç”³è«‹ã€‚
    -   å¿…é ˆæä¾›æˆ¿æºè­‰æ˜æ–‡ä»¶ (`properties.propertyProofURL`)ã€‚

6.  **ç®¡ç†å“¡è·è²¬ç¯„åœ**: 
    -   ç®¡ç†å“¡å°ˆæ³¨æ–¼ã€Œå¯©æ ¸æˆ¿æºæ–‡ä»¶ï¼Œç¢ºå®šå¯©æ ¸æœ‰ç„¡é€šéã€åŠŸèƒ½ã€‚
    -   **ä¸æ¶‰åŠä¸Šæ¶è²»ç”¨è™•ç†**ï¼šä»˜è²»é‚è¼¯ç”±å…¶ä»–æ¨¡çµ„è² è²¬ã€‚
    -   å¯©æ ¸æ±ºç­–åƒ…åŸºæ–¼æˆ¿æºè³‡è¨Šçš„çœŸå¯¦æ€§å’Œå®Œæ•´æ€§ã€‚

7.  **å”¯ä¸€ç´„æŸé‹ç”¨**: 
    -   åˆ©ç”¨ `UQ_approvals_member_module (moduleCode, applicantMemberID, sourcePropertyID)` ç´„æŸã€‚
    -   **ç´„æŸæ•ˆæœ**: åŒä¸€æˆ¿æºåªèƒ½æœ‰ä¸€ç­†å¯©æ ¸è¨˜éŒ„ï¼Œé˜²æ­¢é‡è¤‡ç”³è«‹ã€‚
    -   **é‡æ–°ç”³è«‹æ©Ÿåˆ¶**: æˆ¿æºé‡æ–°ç”³è«‹æ™‚æ›´æ–°ç¾æœ‰ `approvals` è¨˜éŒ„ï¼Œè€Œéå‰µå»ºæ–°è¨˜éŒ„ã€‚

### æ ¸å¿ƒæ¥­å‹™æµç¨‹

#### 1. æäº¤æˆ¿æºç”³è«‹
-   **è§¸ç™¼**: æˆ¿æ±å¡«å¯«æˆ¿æºè³‡è¨Šä¸¦ä¸Šå‚³è­‰æ˜æ–‡ä»¶å¾Œæäº¤ç”³è«‹ã€‚
-   **ç³»çµ±å‹•ä½œ**:
    -   åœ¨ `properties` è¡¨ä¸­å‰µå»ºæˆ¿æºè¨˜éŒ„ï¼Œ`statusCode` è¨­ç‚º `PENDING`ã€‚
    -   åœ¨ `approvals` è¡¨ä¸­å‰µå»ºå¯©æ ¸è¨˜éŒ„ï¼Œ`moduleCode = 'PROPERTY'`ï¼Œ`statusCode` è¨­ç‚º `PENDING`ã€‚
    -   åœ¨ `approvalItems` è¡¨ä¸­å‰µå»ºåˆå§‹è¨˜éŒ„ï¼Œ`actionType` è¨­ç‚º `SUBMIT`ã€‚
    -   `properties.publishedAt` ä¿æŒ `NULL`ï¼Œç­‰å¾…å¯©æ ¸é€šéå¾Œè¨­å®šã€‚

#### 2. å¯©æ ¸é€šé
-   **è§¸ç™¼**: ç®¡ç†å“¡æª¢æŸ¥æˆ¿æºè³‡è¨Šå’Œè­‰æ˜æ–‡ä»¶å¾Œï¼Œé»æ“Šã€Œé€šéã€ã€‚
-   **ç³»çµ±å‹•ä½œ**:
    -   æ›´æ–° `approvals` è¨˜éŒ„çš„ `statusCode` ç‚º `APPROVED`ã€‚
    -   è§¸ç™¼å™¨è‡ªå‹•åŒæ­¥ `properties.statusCode` ç‚º `ACTIVE`ã€‚
    -   è¨­å®š `properties.publishedAt` ç‚ºç•¶å‰æ™‚é–“ï¼ˆæ‰‹å‹•æˆ–é€éæ‡‰ç”¨ç¨‹å¼é‚è¼¯ï¼‰ã€‚
    -   åœ¨ `approvalItems` ä¸­æ–°å¢ä¸€ç­†æ“ä½œè¨˜éŒ„ï¼Œ`actionType` ç‚º `APPROVED`ï¼Œä¸¦è¨˜éŒ„å¯©æ ¸ç®¡ç†å“¡çš„ `admins.adminID`ã€‚
-   **é‡è¦æé†’**: å¯©æ ¸é€šéä¸ç­‰æ–¼æˆ¿æºç«‹å³å¯è¦‹ï¼Œé‚„éœ€è¦æˆ¿æ±å®Œæˆä»˜è²»æµç¨‹ã€‚

#### 3. å¯©æ ¸æ‹’çµ•
-   **è§¸ç™¼**: ç®¡ç†å“¡æª¢æŸ¥å¾Œç™¼ç¾å•é¡Œï¼Œé»æ“Šã€Œæ‹’çµ•ã€ã€‚
-   **ç³»çµ±å‹•ä½œ**:
    -   æ›´æ–° `approvals` è¨˜éŒ„çš„ `statusCode` ç‚º `REJECTED`ã€‚
    -   è§¸ç™¼å™¨è‡ªå‹•åŒæ­¥ `properties.statusCode` ç‚º `REJECTED`ã€‚
    -   åœ¨ `approvalItems` ä¸­æ–°å¢ä¸€ç­†æ“ä½œè¨˜éŒ„ï¼Œ`actionType` ç‚º `REJECT_FINAL`ï¼Œä¸¦è¨˜éŒ„æ‹’çµ•åŸå› ã€‚
    -   `properties.publishedAt` ä¿æŒ `NULL`ã€‚

#### 4. é•è¦å¼·åˆ¶ä¸‹æ¶
-   **è§¸ç™¼**: ç®¡ç†å“¡ç™¼ç¾æˆ¿æºé•è¦ï¼ˆå¦‚è™›å‡è³‡è¨Šã€ä¸ç•¶å…§å®¹ç­‰ï¼‰ã€‚
-   **ç³»çµ±å‹•ä½œ**:
    -   ç®¡ç†å“¡ç›´æ¥è¨­ç½® `properties.statusCode` ç‚º `BANNED`ã€‚
    -   æˆ¿æºç«‹å³å¾å…¬é–‹åˆ—è¡¨ä¸­ç§»é™¤ã€‚
    -   **å¯©æ ¸è¨˜éŒ„è™•ç†**ï¼š
        -   `approvals` è¡¨è¨˜éŒ„ä¿æŒä¸è®Šï¼ˆç¶­æŒæ­·å²å¯©æ ¸ç‹€æ…‹ï¼‰ã€‚
        -   åœ¨ `approvalItems` è¡¨ä¸­æ–°å¢å¼·åˆ¶ä¸‹æ¶æ“ä½œè¨˜éŒ„ï¼š
            - `actionType` è¨­ç‚º `FORCE_BANNED`
            - `actionBy` è¨˜éŒ„åŸ·è¡Œç®¡ç†å“¡çš„ `adminID`
            - `actionNote` è¨˜éŒ„é•è¦åŸå› å’Œä¸‹æ¶ç†ç”±
            - `snapshotJSON` è¨˜éŒ„ä¸‹æ¶æ™‚çš„æˆ¿æºç‹€æ…‹å¿«ç…§
    -   æˆ¿æ±éœ€è¦ä¿®æ­£é•è¦å…§å®¹å¾Œé‡æ–°ç”³è«‹å¯©æ ¸ã€‚
-   **é‡æ–°ä¸Šæ¶æµç¨‹**:
    -   æˆ¿æ±ä¿®æ­£é•è¦å…§å®¹ä¸¦é‡æ–°æäº¤ç”³è«‹ã€‚
    -   æ›´æ–°ç¾æœ‰çš„ `approvals` è¨˜éŒ„ï¼Œ`statusCode` é‡ç½®ç‚º `PENDING`ã€‚
    -   åœ¨ `approvalItems` ä¸­æ–°å¢é‡æ–°ç”³è«‹æ“ä½œè¨˜éŒ„ï¼Œ`actionType` ç‚º `SUBMIT`ã€‚
    -   é€²å…¥æ¨™æº–å¯©æ ¸æµç¨‹ã€‚

#### 5. é‡æ–°ç”³è«‹ä¸Šæ¶
-   **æƒ…å¢ƒ**: è¢«æ‹’çµ•ï¼ˆ`REJECTED`ï¼‰æˆ–é•è¦ä¸‹æ¶ï¼ˆ`BANNED`ï¼‰çš„æˆ¿æºï¼Œæˆ¿æ±ä¿®æ”¹å¾Œé‡æ–°ç”³è«‹ä¸Šæ¶ã€‚
-   **è™•ç†**: 
    -   æª¢æŸ¥æ˜¯å¦æœ‰é€²è¡Œä¸­çš„å¯©æ ¸ï¼Œé¿å…é‡è¤‡ç”³è«‹ã€‚
    -   æ›´æ–°ç¾æœ‰çš„ `approvals` è¨˜éŒ„ï¼Œ`statusCode` é‡ç½®ç‚º `PENDING`ã€‚
    -   åœ¨ `approvalItems` ä¸­æ–°å¢é‡æ–°ç”³è«‹æ“ä½œè¨˜éŒ„ï¼Œ`actionType` ç‚º `SUBMIT`ã€‚
    -   è§¸ç™¼å™¨è‡ªå‹•åŒæ­¥ `properties.statusCode` ç‚º `PENDING`ã€‚
-   **ç´„æŸèªªæ˜**: 
    -   å— `UQ_approvals_member_module` ç´„æŸé™åˆ¶ï¼ŒåŒä¸€æˆ¿æºåªèƒ½æœ‰ä¸€ç­†å¯©æ ¸è¨˜éŒ„ã€‚
    -   é‡æ–°ç”³è«‹æ™‚æ›´æ–°ç¾æœ‰è¨˜éŒ„è€Œéå‰µå»ºæ–°è¨˜éŒ„ï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§ã€‚

#### 6. æˆ¿æºä¿®æ”¹å¾Œé‡æ–°å¯©æ ¸ï¼ˆæš«ä¸å¯¦ä½œï¼‰
-   **æƒ…å¢ƒ**: å·²ä¸Šæ¶æˆ¿æºçš„æˆ¿æ±ä¿®æ”¹é—œéµè³‡è¨Šï¼ˆå¦‚åœ°å€ã€ç§Ÿé‡‘ç­‰ï¼‰ï¼Œè§¸ç™¼é‡æ–°å¯©æ ¸ã€‚
-   **å¯¦ä½œç‹€æ…‹**: **æš«æ™‚ä¸å¯¦ä½œæ­¤åŠŸèƒ½**
-   **åŸå› **: ç‚ºç°¡åŒ–åˆæœŸç³»çµ±è¤‡é›œåº¦ï¼Œæš«æ™‚å…è¨±æˆ¿æ±ä¿®æ”¹è³‡è¨Šè€Œä¸è§¸ç™¼é‡æ–°å¯©æ ¸ã€‚
-   **æœªä¾†è¦åŠƒ**: å¾ŒçºŒç‰ˆæœ¬å¯è€ƒæ…®å¯¦ä½œé—œéµæ¬„ä½è®Šæ›´è§¸ç™¼é‡æ–°å¯©æ ¸æ©Ÿåˆ¶ã€‚

---

### å­è¡¨èˆ‡è£œå……èªªæ˜

#### `properties.propertyProofURL` æ¬„ä½
-   **æ¥­å‹™è¦å‰‡**: æˆ¿æºå¯©æ ¸å¿…é ˆæä¾›è­‰æ˜æ–‡ä»¶ï¼Œå¦‚æˆ¿å±‹æ‰€æœ‰æ¬Šç‹€ã€ç§Ÿè³ƒå¥‘ç´„ç­‰ã€‚
-   **æ ¼å¼è¦æ±‚**: å„²å­˜æ–‡ä»¶çš„URLè·¯å¾‘ï¼Œæ”¯æ´PDFã€JPGã€PNGç­‰æ ¼å¼ã€‚
-   **å¯©æ ¸é‡é»**: ç®¡ç†å“¡éœ€è¦é©—è­‰æ–‡ä»¶çš„çœŸå¯¦æ€§å’Œå®Œæ•´æ€§ã€‚

#### ä»˜è²»èˆ‡æ—¥æœŸæ¬„ä½æ©Ÿåˆ¶

##### `properties.paidAt` æ¬„ä½
-   **è¨­å®šæ™‚æ©Ÿ**: æˆ¿æ±å®Œæˆä»˜è²»æ™‚è‡ªå‹•è¨˜éŒ„ç¹³è²»æ™‚é–“é»ã€‚
-   **è³‡æ–™é¡å‹**: datetime2ï¼Œè¨˜éŒ„ç²¾ç¢ºçš„ä»˜è²»æ™‚é–“ã€‚
-   **ç®¡ç†ç¯„åœ**: ç”±ä»˜è²»æ¨¡çµ„è‡ªå‹•ç®¡ç†ï¼Œå¯©æ ¸æ¨¡çµ„ä¸æ¶‰åŠã€‚

##### `properties.publishedAt` æ¬„ä½
-   **è¨­å®šæ™‚æ©Ÿ**: ç”± `paidAt` æ™‚é–“æ¨ç®—ç”Ÿæˆçš„ç™¼å¸ƒæ—¥æœŸã€‚
-   **è¨ˆç®—é‚è¼¯**: åŸºæ–¼ä»˜è²»æ™‚é–“é»è¨ˆç®—å°å¤–ç™¼å¸ƒçš„æ—¥æœŸã€‚
-   **æ¥­å‹™ç”¨é€”**: ç”¨æ–¼æˆ¿æºæœå°‹æ’åºå’Œé¡¯ç¤ºé †åºã€‚
-   **ç®¡ç†ç¯„åœ**: ç”±ä»˜è²»æ¨¡çµ„æ ¹æ“š `paidAt` è‡ªå‹•è¨ˆç®—ã€‚

##### `properties.expireAt` æ¬„ä½
-   **è¨­å®šæ™‚æ©Ÿ**: æ ¹æ“šç¹³è²»æ–¹æ¡ˆè‡ªå‹•æ¨ç®—ä¸Šæ¶åˆ°æœŸæ™‚é–“ã€‚
-   **è¨ˆç®—é‚è¼¯**: åŸºæ–¼ä»˜è²»æ™‚é–“é»å’Œé¸æ“‡çš„ä¸Šæ¶æ–¹æ¡ˆè¨ˆç®—ã€‚
-   **æ¥­å‹™ç”¨é€”**: æ±ºå®šæˆ¿æºå¯è¦‹æ€§çš„æœ‰æ•ˆæœŸé™ã€‚
-   **ç®¡ç†ç¯„åœ**: ç”±ä»˜è²»æ¨¡çµ„è² è²¬è¨ˆç®—å’Œç®¡ç†ã€‚

##### `properties.isPaid` æ¬„ä½
-   **æ¥­å‹™è¦å‰‡**: æˆ¿æºå¯è¦‹æ€§çš„é—œéµæ¬„ä½ï¼Œèˆ‡å¯©æ ¸ç‹€æ…‹ç¨ç«‹ã€‚
-   **è¨­å®šé‚è¼¯**: åŸºæ–¼ä»˜è²»ç‹€æ…‹å’Œæœ‰æ•ˆæœŸè‡ªå‹•æ›´æ–°ã€‚
-   **ç®¡ç†ç¯„åœ**: ç”±ä»˜è²»æ¨¡çµ„è² è²¬ç®¡ç†ã€‚

**å¾Œå°ç®¡ç†ç³»çµ±è·è²¬**ï¼š
-   åƒ…éœ€è¦**é¡¯ç¤º**ä¸Šè¿°ä»˜è²»ç›¸é—œæ—¥æœŸè³‡è¨Š
-   **ä¸éœ€è¦æ“ä½œ**ä»˜è²»é‚è¼¯æˆ–æ—¥æœŸè¨ˆç®—
-   å°ˆæ³¨æ–¼å¯©æ ¸åŠŸèƒ½çš„å¯¦ç¾

#### `approvalItems.snapshotJSON` æ¬„ä½
-   **æˆ¿æºç‰¹å®šç”¨é€”**: å„²å­˜æˆ¿æºåœ¨å¯©æ ¸æ™‚çš„å®Œæ•´è³‡æ–™å¿«ç…§ã€‚
-   **å…§å®¹åŒ…å«**: æˆ¿æºåŸºæœ¬è³‡è¨Šã€ç§Ÿé‡‘ã€åœ°å€ã€è­‰æ˜æ–‡ä»¶URLç­‰ã€‚
-   **ç¨½æ ¸åƒ¹å€¼**: å¦‚æœæˆ¿æºè³‡æ–™åœ¨å¯©æ ¸å¾Œè¢«ä¿®æ”¹ï¼Œå¯è¿½æº¯å¯©æ ¸æ™‚çš„åŸå§‹ç‹€æ…‹ã€‚

#### ç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶
-   **è‡ªå‹•åŒæ­¥å¯¦ç¾**: é€šéè³‡æ–™åº«è§¸ç™¼å™¨ `trg_approvals_status_sync` å¯¦ç¾è‡ªå‹•åŒæ­¥ã€‚
-   **åŒæ­¥é‚è¼¯**: ç•¶ `approvals.statusCode` æ›´æ–°æ™‚ï¼Œè‡ªå‹•åŒæ­¥å°æ‡‰çš„ `properties.statusCode`ï¼š
    -   `APPROVED` â†’ `ACTIVE`
    -   `PENDING` â†’ `PENDING`
    -   `REJECTED` â†’ `REJECTED`
-   **ç¨ç«‹ç‹€æ…‹ç®¡ç†**: æˆ¿æ±å¯ç›´æ¥ä¿®æ”¹ `properties.statusCode` é€²è¡Œæˆ¿æºç®¡ç†ï¼ˆå¦‚æš«æ™‚ä¸‹æ¶ï¼‰ï¼Œä¸å½±éŸ¿å¯©æ ¸è¨˜éŒ„ã€‚
-   **æˆ¿æ±èº«ä»½é©—è­‰**: è§¸ç™¼å™¨ `trg_properties_validate_landlord` ç¢ºä¿åªæœ‰æˆ¿æ±èƒ½æ“ä½œæˆ¿æºã€‚

---

## ç®¡ç†å“¡å¾Œå°æˆ¿æºç¸½è¡¨ç¯©é¸å™¨è¨­è¨ˆ

### ç¯©é¸å™¨åŠŸèƒ½è¨­è¨ˆ

ç®¡ç†å“¡å¾Œå°çš„ã€Œæˆ¿æºç¸½è¡¨ã€é é¢æä¾› **3ç¨®ç¯©é¸ç‹€æ…‹**ï¼Œé€éæ™ºèƒ½è­˜åˆ¥é‚è¼¯èƒ½å¤ æ‡‰å°ç”¨æˆ¶ä»‹é¢é–‹ç™¼è€…å¯èƒ½æ–°å¢çš„æœªçŸ¥ç‹€æ…‹ç¢¼ã€‚

#### ç¯©é¸é¸é …å®šç¾©

1. **å¾…å¯©æ ¸**
   - **ç¯©é¸æ¢ä»¶**: `properties.statusCode = 'PENDING'`
   - **æ¥­å‹™å«ç¾©**: æˆ¿æ±å·²æäº¤ç”³è«‹ï¼Œç­‰å¾…ç®¡ç†å“¡å¯©æ ¸
   - **åŒ…å«æƒ…å¢ƒ**: æ–°ç”³è«‹ã€é‡æ–°ç”³è«‹ä¸Šæ¶

2. **å¯©æ ¸é€šé**
   - **ç¯©é¸æ¢ä»¶**: `approvals.statusCode = 'APPROVED' AND properties.statusCode != 'BANNED'`
   - **æ¥­å‹™å«ç¾©**: å·²é€šéå¯©æ ¸çš„æˆ¿æºï¼Œç„¡è«–æˆ¿æ±å¾ŒçºŒå¦‚ä½•ç®¡ç†
   - **åŒ…å«æƒ…å¢ƒ**: æ­£å¸¸ä¸Šæ¶ã€æˆ¿æ±æš«æ™‚ä¸‹æ¶ã€ç¶­è­·ä¸­ç­‰æ‰€æœ‰éé•è¦ç‹€æ…‹

3. **å¼·åˆ¶ä¸‹æ¶éœ€é‡æ–°å¯©æ ¸**
   - **ç¯©é¸æ¢ä»¶**: `properties.statusCode = 'BANNED'`
   - **æ¥­å‹™å«ç¾©**: å› é•è¦è¢«ç®¡ç†å“¡å¼·åˆ¶ä¸‹æ¶çš„æˆ¿æº
   - **åŒ…å«æƒ…å¢ƒ**: é•è¦ä¸‹æ¶å¾Œç­‰å¾…é‡æ–°ç”³è«‹

#### å¯¦ä½œå»ºè­°çš„ SQL æŸ¥è©¢

```sql
-- ç®¡ç†å“¡å¾Œå°æˆ¿æºç¸½è¡¨ç¯©é¸å™¨æŸ¥è©¢
SELECT 
    p.propertyID,
    p.title,
    p.statusCode as property_status,
    a.statusCode as approval_status,
    p.isPaid,
    p.expireAt,
    p.createdAt,
    p.updatedAt,
    -- ç¯©é¸å™¨ç‹€æ…‹åˆ†é¡
    CASE 
        WHEN p.statusCode = 'PENDING' THEN 'å¾…å¯©æ ¸'
        WHEN a.statusCode = 'APPROVED' AND p.statusCode != 'BANNED' THEN 'å¯©æ ¸é€šé'
        WHEN p.statusCode = 'BANNED' THEN 'å¼·åˆ¶ä¸‹æ¶éœ€é‡æ–°å¯©æ ¸'
        ELSE 'å…¶ä»–ç‹€æ…‹'
    END AS filter_category,
    -- è©³ç´°ç‹€æ…‹èªªæ˜ï¼ˆä¾›ç®¡ç†å“¡åƒè€ƒï¼‰
    CASE 
        WHEN p.statusCode = 'PENDING' THEN 'ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸'
        WHEN p.statusCode = 'ACTIVE' AND a.statusCode = 'APPROVED' THEN 'å¯©æ ¸é€šéãƒ»æ­£å¸¸ä¸Šæ¶'
        WHEN p.statusCode = 'BANNED' THEN 'å› é•è¦è¢«å¼·åˆ¶ä¸‹æ¶'
        WHEN p.statusCode = 'REJECTED' THEN 'å¯©æ ¸æœªé€šé'
        WHEN a.statusCode = 'APPROVED' AND p.statusCode != 'BANNED' THEN 'å¯©æ ¸é€šéãƒ»æˆ¿æ±ç®¡ç†ä¸­'
        ELSE 'æœªçŸ¥ç‹€æ…‹ãƒ»éœ€æª¢æŸ¥'
    END AS status_description
FROM properties p
LEFT JOIN approvals a ON p.propertyID = a.sourcePropertyID 
    AND a.moduleCode = 'PROPERTY'
ORDER BY p.updatedAt DESC;
```

#### å‰ç«¯ç¯©é¸å™¨å¯¦ä½œå»ºè­°

```javascript
// ç¯©é¸å™¨é¸é …å®šç¾©
const filterOptions = [
    { 
        value: 'pending', 
        label: 'å¾…å¯©æ ¸', 
        condition: "properties.statusCode = 'PENDING'",
        color: 'orange' 
    },
    { 
        value: 'approved', 
        label: 'å¯©æ ¸é€šé', 
        condition: "approvals.statusCode = 'APPROVED' AND properties.statusCode != 'BANNED'",
        color: 'green' 
    },
    { 
        value: 'banned', 
        label: 'å¼·åˆ¶ä¸‹æ¶éœ€é‡æ–°å¯©æ ¸', 
        condition: "properties.statusCode = 'BANNED'",
        color: 'red' 
    }
];
```

#### è¨­è¨ˆå„ªå‹¢

1. **éˆæ´»æ€§é«˜**: èƒ½æ‡‰å°ç”¨æˆ¶ä»‹é¢é–‹ç™¼è€…æ–°å¢çš„æœªçŸ¥ç‹€æ…‹ç¢¼
2. **é‚è¼¯æ¸…æ™°**: ç®¡ç†å“¡åƒ…éœ€é—œæ³¨å¯©æ ¸ç›¸é—œç‹€æ…‹
3. **å¯¦ç”¨æ€§å¼·**: æ¶µè“‹äº†ä¸»è¦çš„ç®¡ç†å ´æ™¯
4. **æ“´å±•æ€§å¥½**: æœªä¾†å¯ä»¥è¼•é¬†æ·»åŠ æ–°çš„ç¯©é¸æ¢ä»¶

---

## 6ç¨®æˆ¿æºå¯©æ ¸æƒ…å¢ƒç¤ºä¾‹

ä»¥ä¸‹ç‚ºå®Œæ•´çš„æˆ¿æºå¯©æ ¸æ¨¡çµ„æ¸¬è©¦æ¡ˆä¾‹ï¼Œæ¶µè“‹æˆ¿æºç”Ÿå‘½é€±æœŸçš„ä¸»è¦æƒ…å¢ƒï¼š

### æƒ…å¢ƒ1: æ–°æˆ¿æºæäº¤å¯©æ ¸ (å¾…å¯©æ ¸)
**æˆ¿æºç‹€æ…‹**:
- `properties.statusCode`: `PENDING`
- `properties.publishedAt`: NULL
- `properties.propertyProofURL`: æœ‰å€¼

**å¯©æ ¸è¨˜éŒ„**:
- `approvals`: moduleCode='PROPERTY', statusCode='PENDING'
- `approvalItems`: actionType='SUBMIT' (actionBy=NULL)

**æ¥­å‹™å«ç¾©**: æˆ¿æ±å·²æäº¤æˆ¿æºç”³è«‹ï¼Œç­‰å¾…ç®¡ç†å“¡å¯©æ ¸

### æƒ…å¢ƒ2: æˆ¿æºå¯©æ ¸é€šé (å·²ä¸Šæ¶)
**æˆ¿æºç‹€æ…‹**:
- `properties.statusCode`: `ACTIVE`
- `properties.publishedAt`: æœ‰å€¼ (å¯©æ ¸é€šéæ™‚é–“)
- `properties.propertyProofURL`: æœ‰å€¼

**å¯©æ ¸è¨˜éŒ„**:
- `approvals`: moduleCode='PROPERTY', statusCode='APPROVED'
- `approvalItems`: 
  - actionType='SUBMIT' (actionBy=NULL)
  - actionType='APPROVED' (actionBy=ç®¡ç†å“¡ID)

**æ¥­å‹™å«ç¾©**: æˆ¿æºå¯©æ ¸é€šéï¼Œä½†éœ€è¦å®Œæˆä»˜è²»æµç¨‹æ‰èƒ½å°å¤–å¯è¦‹

### æƒ…å¢ƒ3: æˆ¿æºå¯©æ ¸è¢«æ‹’çµ•
**æˆ¿æºç‹€æ…‹**:
- `properties.statusCode`: `REJECTED`
- `properties.publishedAt`: NULL
- `properties.propertyProofURL`: æœ‰å€¼

**å¯©æ ¸è¨˜éŒ„**:
- `approvals`: moduleCode='PROPERTY', statusCode='REJECTED'
- `approvalItems`:
  - actionType='SUBMIT' (actionBy=NULL)
  - actionType='REJECT_FINAL' (actionBy=ç®¡ç†å“¡ID)

**æ¥­å‹™å«ç¾©**: æˆ¿æºå¯©æ ¸ä¸é€šéï¼Œç„¡æ³•ä¸Šæ¶ï¼Œéœ€è¦æˆ¿æ±ä¿®æ”¹å¾Œé‡æ–°ç”³è«‹

### æƒ…å¢ƒ4: å·²ä¸Šæ¶æˆ¿æºä¿®æ”¹å¾Œé‡æ–°å¯©æ ¸
**æˆ¿æºç‹€æ…‹**:
- `properties.statusCode`: `PENDING` (å¾ACTIVEè®Šæ›´)
- `properties.publishedAt`: æœ‰å€¼ (ä¿ç•™åŸç™¼å¸ƒæ™‚é–“)
- `properties.propertyProofURL`: æœ‰å€¼

**å¯©æ ¸è¨˜éŒ„**:
- æ›´æ–°å¾Œçš„å¯©æ ¸: moduleCode='PROPERTY', statusCode='PENDING' (ç”±APPROVEDé‡ç½®)
- å°æ‡‰çš„ `approvalItems` æ“ä½œæ­·ç¨‹åŒ…å«å®Œæ•´çš„ä¿®æ”¹èˆ‡é‡æ–°ç”³è«‹è¨˜éŒ„

**æ¥­å‹™å«ç¾©**: æˆ¿æºå› ä¿®æ”¹é‡è¦è³‡è¨Šéœ€é‡æ–°å¯©æ ¸ï¼Œæš«æ™‚å¾å…¬é–‹åˆ—è¡¨ç§»é™¤

### æƒ…å¢ƒ5: è¢«æ‹’çµ•æˆ¿æºé‡æ–°ç”³è«‹ä¸Šæ¶
**æˆ¿æºç‹€æ…‹**:
- `properties.statusCode`: `PENDING` (å¾REJECTEDè®Šæ›´)
- `properties.publishedAt`: NULL
- `properties.propertyProofURL`: æœ‰å€¼ (å¯èƒ½å·²æ›´æ–°)

**å¯©æ ¸è¨˜éŒ„**:
- æ›´æ–°å¾Œçš„å¯©æ ¸: moduleCode='PROPERTY', statusCode='PENDING' (ç”±REJECTEDé‡ç½®)
- å®Œæ•´çš„æ“ä½œæ­·ç¨‹è¿½è¹¤ï¼ŒåŒ…å«æ‹’çµ•åŸå› å’Œé‡æ–°ç”³è«‹è¨˜éŒ„

**æ¥­å‹™å«ç¾©**: æˆ¿æ±ä¿®æ”¹è¢«æ‹’çµ•çš„æˆ¿æºå¾Œé‡æ–°ç”³è«‹ï¼Œé€²å…¥æ–°çš„å¯©æ ¸æµç¨‹

### æƒ…å¢ƒ6: é•è¦å¼·åˆ¶ä¸‹æ¶æˆ¿æº
**æˆ¿æºç‹€æ…‹**:
- `properties.statusCode`: `BANNED` (ç®¡ç†å“¡è¨­ç½®)
- `properties.publishedAt`: æœ‰å€¼ (ä¿ç•™åŸç™¼å¸ƒæ™‚é–“)
- `properties.propertyProofURL`: æœ‰å€¼
- `properties.isPaid`: true (ä»˜è²»ç‹€æ…‹ä¿æŒ)
- `properties.expireAt`: æœ‰å€¼ (éæœŸæ™‚é–“ä¿æŒ)

**å¯©æ ¸è¨˜éŒ„**:
- æ­·å²å¯©æ ¸: moduleCode='PROPERTY', statusCode='APPROVED' (ä¸è®Š)
- åŸæ“ä½œæ­·ç¨‹ä¿æŒä¸è®Š

**æ¥­å‹™å«ç¾©**: æˆ¿æºå› é•è¦è¢«ç®¡ç†å“¡å¼·åˆ¶ä¸‹æ¶ï¼Œéœ€è¦ä¿®æ­£å¾Œé‡æ–°ç”³è«‹å¯©æ ¸

### ç³»çµ±æ”¹é€²å¯¦æ–½ç‹€æ…‹

#### âœ… å·²å®Œæˆæ”¹é€²é …ç›®
1. **âœ… ç‹€æ…‹æ ¼å¼çµ±ä¸€**: æ‰€æœ‰ç‹€æ…‹å€¼çµ±ä¸€ä½¿ç”¨å¤§å¯«æ ¼å¼ ('PENDING', 'ACTIVE', 'REJECTED')
2. **âœ… å®Œå–„å¯©æ ¸è¨˜éŒ„**: æ‰€æœ‰æˆ¿æºéƒ½æœ‰å°æ‡‰çš„å¯©æ ¸æ­·ç¨‹è¨˜éŒ„
3. **âœ… ç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶**: é€šéè§¸ç™¼å™¨å¯¦ç¾è‡ªå‹•åŒæ­¥
   - `trg_approvals_status_sync`: å¯©æ ¸ç‹€æ…‹è®Šæ›´æ™‚è‡ªå‹•åŒæ­¥åˆ°æˆ¿æºç‹€æ…‹
   - `trg_properties_status_protection`: é˜²æ­¢ç›´æ¥æ›´æ”¹æˆ¿æºç‹€æ…‹
4. **âœ… æˆ¿æ±èº«ä»½é©—è­‰**: `trg_properties_validate_landlord` ç¢ºä¿åªæœ‰æˆ¿æ±èƒ½æ“ä½œæˆ¿æº

#### ğŸ”’ ç³»çµ±å®‰å…¨æ©Ÿåˆ¶
- **è§¸ç™¼å™¨é˜²è­·**: ç¦æ­¢ç›´æ¥ä¿®æ”¹ `properties.statusCode`ï¼Œå¿…é ˆé€šéå¯©æ ¸ç³»çµ±
- **å”¯ä¸€ç´„æŸ**: `UQ_approvals_member_module` é˜²æ­¢é‡è¤‡å¯©æ ¸ç”³è«‹
- **èº«ä»½é©—è­‰**: ç¢ºä¿åªæœ‰å·²é©—è­‰æˆ¿æ±èƒ½æäº¤æˆ¿æºç”³è«‹

#### ğŸ“Š è³‡æ–™ä¸€è‡´æ€§é©—è­‰
- **ç‹€æ…‹åŒæ­¥**: 100% properties å’Œ approvals ç‹€æ…‹åŒæ­¥ä¸€è‡´
- **å¯©æ ¸è¨˜éŒ„**: 100% æˆ¿æºæ“æœ‰å®Œæ•´å¯©æ ¸æ­·ç¨‹
- **æ¥­å‹™é‚è¼¯**: ç¬¦åˆå¯©æ ¸â†’ä»˜è²»â†’å¯è¦‹çš„å®Œæ•´æµç¨‹

#### æ¸¬è©¦è³‡æ–™å»ºè­°
**æˆ¿æºè³‡æ–™è¡¨ (properties)**:
- æˆ¿æºID 3001-3005 åˆ†åˆ¥å°æ‡‰ä¸Šè¿°5ç¨®æƒ…å¢ƒ

**å¯©æ ¸è¨˜éŒ„è¡¨ (approvals)**:
- å°æ‡‰çš„æˆ¿æºå¯©æ ¸è¨˜éŒ„ï¼ŒåŒ…å«å„ç¨®ç‹€æ…‹çµ„åˆ

**æ“ä½œæ­·ç¨‹è¡¨ (approvalItems)**:
- å®Œæ•´çš„å¯©æ ¸æ“ä½œæ­·ç¨‹ï¼Œè¿½è¹¤æ¯å€‹å¯©æ ¸çš„æäº¤å’Œçµæœ

**ç´„æŸé©—è­‰**:
- åˆ©ç”¨ `UQ_approvals_member_module` ç´„æŸé˜²æ­¢é‡è¤‡å¯©æ ¸
- ç¢ºä¿æˆ¿æºå¯©æ ¸çš„æ¥­å‹™é‚è¼¯å®Œæ•´æ€§

### æ¸¬è©¦è³‡æ–™æ¥­å‹™é‚è¼¯é©—è­‰

ä»¥ä¸‹æ˜¯ç¾æœ‰æ¸¬è©¦è³‡æ–™çš„æ¥­å‹™é‚è¼¯åˆ†æï¼š

#### æˆ¿æºå¯è¦‹æ€§æª¢æŸ¥
```sql
-- æˆ¿æºå°å¤–å¯è¦‹æ€§æŸ¥è©¢
SELECT 
    propertyID,
    title,
    statusCode,
    isPaid,
    expireAt,
    CASE 
        WHEN statusCode = 'ACTIVE' AND isPaid = 1 AND expireAt > GETDATE() THEN 'å°å¤–å¯è¦‹'
        WHEN statusCode = 'ACTIVE' AND isPaid = 0 THEN 'å¯©æ ¸é€šéä½†æœªä»˜è²»'
        WHEN statusCode = 'ACTIVE' AND isPaid = 1 AND expireAt <= GETDATE() THEN 'å¯©æ ¸é€šéä½†å·²éæœŸ'
        WHEN statusCode = 'PENDING' THEN 'å¯©æ ¸ä¸­'
        WHEN statusCode = 'REJECTED' THEN 'å¯©æ ¸æ‹’çµ•'
        WHEN statusCode = 'BANNED' THEN 'é•è¦å¼·åˆ¶ä¸‹æ¶'
        ELSE 'å…¶ä»–ç‹€æ…‹(ç”±ç”¨æˆ¶ä»‹é¢é–‹ç™¼è€…å®šç¾©)'
    END AS å¯¦éš›ç‹€æ…‹
FROM properties 
ORDER BY propertyID;
```

#### æ¸¬è©¦è³‡æ–™ç‹€æ…‹åˆ†æ
1. **æˆ¿æº2001, 2002, 3011**: å¯©æ ¸é€šéä½†æœªä»˜è²» â†’ ç”¨æˆ¶ä¸å¯è¦‹
2. **æˆ¿æº2006, 3012**: å¯©æ ¸æ‹’çµ• â†’ ç”¨æˆ¶ä¸å¯è¦‹
3. **æˆ¿æº3001**: å¯©æ ¸é€šéä¸”å·²ä»˜è²» â†’ ç”¨æˆ¶å¯è¦‹ï¼ˆä½†ç¼ºå°‘publishedAtï¼‰
4. **æˆ¿æº3010**: å¯©æ ¸ä¸­ â†’ ç”¨æˆ¶ä¸å¯è¦‹
5. **æˆ¿æº3020**: å®Œå…¨å¯è¦‹ç¯„ä¾‹ â†’ ç”¨æˆ¶å¯è¦‹ï¼ˆå¯©æ ¸é€šé + å·²ä»˜è²» + æœªéæœŸï¼‰
6. **æˆ¿æº3030**: é•è¦å¼·åˆ¶ä¸‹æ¶ç¯„ä¾‹ â†’ ç”¨æˆ¶ä¸å¯è¦‹ï¼ˆéœ€è¦é‡æ–°ç”³è«‹å¯©æ ¸ï¼‰

#### æ¥­å‹™é‚è¼¯ä¸€è‡´æ€§
- âœ… å¯©æ ¸æ¨¡çµ„è·è²¬æ¸…æ™°ï¼šåƒ…è™•ç†å¯©æ ¸ç‹€æ…‹
- âœ… ä»˜è²»é‚è¼¯ç¨ç«‹ï¼šç”±å…¶ä»–æ¨¡çµ„è² è²¬
- âœ… å¯è¦‹æ€§æ¢ä»¶å®Œæ•´ï¼šéœ€è¦å¯©æ ¸é€šé + ä»˜è²»æœ‰æ•ˆ
- âœ… ç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶ï¼šè§¸ç™¼å™¨ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- âœ… å®‰å…¨é˜²è­·æ©Ÿåˆ¶ï¼šé˜²æ­¢éæ³•ç‹€æ…‹ä¿®æ”¹
- âœ… æ¸¬è©¦è³‡æ–™å®Œæ•´ï¼šæ¶µè“‹æ‰€æœ‰æ¥­å‹™å ´æ™¯åŒ…æ‹¬å®Œå…¨å¯è¦‹æˆ¿æº