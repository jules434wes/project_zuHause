@{
	ViewData["Title"] = "å…¬å‘Šç®¡ç†";
}

<div class="container-fluid">
	<div class="row">
		<div class="col-12">
			<div class="card">
				<div class="card-header d-flex justify-content-between align-items-center">
					<h5 class="mb-0">ğŸ“¢ å…¬å‘Šç®¡ç†</h5>
					<button type="button" class="btn btn-primary btn-lg" id="addAnnouncementBtn">
						<i class="bi bi-plus-circle"></i> æ–°å¢å…¬å‘Š
					</button>
				</div>
				<div class="card-body">
					<div class="row mb-3">
						<div class="col-md-6">
							<div class="input-group">
								<input type="text" class="form-control" id="announcementSearchInput" placeholder="æœå°‹å…¬å‘Šæ¨™é¡Œæˆ–å…§å®¹...">
								<button class="btn btn-outline-secondary" type="button" id="announcementSearchBtn">
									<i class="bi bi-search"></i>
								</button>
							</div>
						</div>
						@* <div class="col-md-2">
                            <select class="form-select" id="announcementStatusFilter">
                                <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                                <option value="true">å·²ç™¼å¸ƒ</option>
                                <option value="false">æœªç™¼å¸ƒ</option>
                            </select>
                        </div> *@
						<div class="col-md-3">
							<select class="form-select" id="announcementScopeFilter">
								<option value="">æ‰€æœ‰ç¯„åœ</option>
								<option value="TENANT">ç§Ÿæˆ¶ç«¯</option>
								<option value="LANDLORD">æˆ¿æ±ç«¯</option>
								<option value="FURNITURE">å®¶å…·ç«¯</option>
								<option value="COMMON">é€šç”¨</option>
							</select>
						</div>
						@* here *@
						<div class="col-md-2">
							<select class="form-select" id="announcementStatusFilter">
								<option value="">æ‰€æœ‰ç‹€æ…‹</option>
								<option value="true">å·²ç™¼å¸ƒ</option>
								<option value="false">æœªç™¼å¸ƒ</option>
							</select>
						</div>

						<div class="col-md-1">
							<button type="button" class="btn btn-outline-secondary w-100" id="announcementResetFiltersBtn">
								<i class="bi bi-arrow-clockwise"></i> é‡ç½®
							</button>
						</div>
					</div>

					<div class="table-responsive">
						<table class="table table-hover">
							<thead class="table-light">
								<tr>
									<th width="5%">
										<input type="checkbox" class="form-check-input">
									</th>
									<th width="35%">æ¨™é¡Œ</th>
									<th width="15%">ç¯„åœ</th>
									<th width="10%">ç‹€æ…‹</th>
									<th width="15%">å»ºç«‹æ—¥æœŸ</th>
									<th width="10%">ç”Ÿæ•ˆæ™‚é–“</th>
									<th width="15%">æ“ä½œ</th>
								</tr>
							</thead>
							<tbody id="announcementTableBody">
								<!-- å‹•æ…‹è¼‰å…¥çš„å…¬å‘Šè³‡æ–™ -->
								<tr id="loadingRow">
									<td colspan="6" class="text-center">
										<div class="spinner-border spinner-border-sm" role="status">
											<span class="visually-hidden">è¼‰å…¥ä¸­...</span>
										</div>
										è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- åˆ†é  -->
					<nav aria-label="å…¬å‘Šåˆ†é ">
						<ul class="pagination justify-content-center" id="paginationList">
							<!-- JavaScript å‹•æ…‹è¼‰å…¥åˆ†é  -->
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- æ–°å¢/ç·¨è¼¯å…¬å‘Šæ¨¡æ…‹æ¡† -->
<div class="modal fade" id="announcementModal" tabindex="-1" aria-labelledby="announcementModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="announcementModalLabel">æ–°å¢å…¬å‘Š</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form id="announcementForm">
					<input type="hidden" id="announcementId" name="siteMessagesId">

					<!-- æ¨¡æ¿é¸æ“‡å€å¡Š -->
					<div class="row mb-3" id="announcementTemplateSection" style="display: none;">
						<div class="col-md-8">
							<label for="announcementTemplateSelect" class="form-label">é¸æ“‡æ’å…¥æ¨¡æ¿</label>
							<select class="form-select" id="announcementTemplateSelect">
								<option value="">è«‹é¸æ“‡æ¨¡æ¿...</option>
								<!-- å‹•æ…‹è¼‰å…¥æ¨¡æ¿é¸é … -->
							</select>
						</div>
						@* <div class="col-md-4">
							<label class="form-label">&nbsp;</label>
							<div> *@
								@* <button type="button" class="btn btn-outline-secondary w-100" id="announcementResetFormBtn">
									<i class="bi bi-arrow-clockwise"></i> é‡ç½®
								</button> *@
						@* 	</div>
						</div> *@
					</div>

					<div class="mb-3">
						<label for="announcementTitle" class="form-label">æ¨™é¡Œ <span class="text-danger">*</span></label>
						<input type="text" class="form-control" id="announcementTitle" name="title" required>
					</div>

					<div class="row mb-3">
						<div class="col-md-6">
							<label for="announcementScope" class="form-label">é©ç”¨ç¯„åœ <span class="text-danger">*</span></label>
							<select class="form-select" id="announcementScope" name="moduleScope" required>
								<option value="">è«‹é¸æ“‡...</option>
								<option value="TENANT">ç§Ÿæˆ¶ç«¯</option>
								<option value="LANDLORD">æˆ¿æ±ç«¯</option>
								<option value="FURNITURE">å®¶å…·ç«¯</option>
								<option value="COMMON">é€šç”¨</option>
							</select>
						</div>
						<div class="col-md-6">
							<label for="announcementDisplayOrder" class="form-label">é¡¯ç¤ºé †åº</label>
							<input type="number" class="form-control" id="announcementDisplayOrder" name="displayOrder" value="1" min="1">
						</div>
					</div>

					<div class="mb-3">
						<label for="announcementContent" class="form-label">å…§å®¹ <span class="text-danger">*</span></label>
						<textarea class="form-control" id="announcementContent" name="siteMessageContent" rows="8" required></textarea>
					</div>

					<div class="row mb-3">
						<div class="col-md-6">
							<label for="announcementStartAt" class="form-label">é–‹å§‹æ™‚é–“</label>
							<input type="datetime-local" class="form-control" id="announcementStartAt" name="startAt">
						</div>
						<div class="col-md-6">
							<label for="announcementEndAt" class="form-label">çµæŸæ™‚é–“</label>
							<input type="datetime-local" class="form-control" id="announcementEndAt" name="endAt">
						</div>
					</div>

					<div class="row mb-3">
						<div class="col-md-8">
							<label for="announcementAttachmentUrl" class="form-label">é™„ä»¶ç¶²å€</label>
							<input type="url" class="form-control" id="announcementAttachmentUrl" name="attachmentUrl" placeholder="https://...">
						</div>
						<div class="col-md-4">
							<div class="form-check mt-4">
								<input class="form-check-input" type="checkbox" id="announcementIsActive" name="isActive" checked>
								<label class="form-check-label" for="announcementIsActive">
									ç«‹å³ç™¼å¸ƒ
								</label>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-secondary" id="announcementResetFormBtn">
					<i class="bi bi-arrow-clockwise"></i> é‡ç½®
				</button>

				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
				<button type="button" class="btn btn-primary" id="saveAnnouncementBtn">å„²å­˜</button>
			</div>
		</div>
	</div>
</div>

<!-- é è¦½å…¬å‘Šæ¨¡æ…‹æ¡† -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="previewModalLabel">å…¬å‘Šé è¦½</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div id="previewContent">
					<!-- å‹•æ…‹è¼‰å…¥çš„é è¦½å…§å®¹ -->
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
			</div>
		</div>
	</div>
</div>

<style>
	.card {
		box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
		border: 1px solid rgba(0, 0, 0, 0.125);
	}

	.table th {
		border-top: none;
		font-weight: 600;
	}

	.btn-group-sm > .btn {
		padding: 0.25rem 0.5rem;
	}

	.badge {
		font-size: 0.75rem;
	}

	.announcement-content-preview {
		max-width: 200px;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
		white-space: normal;
		max-height: 3em;
		line-height: 1.5em;
		word-break: break-word;
	}

	.modal-body textarea {
		resize: vertical;
	}

	.loading-overlay {
		position: relative;
	}

		.loading-overlay::after {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(255, 255, 255, 0.8);
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 1;
		}

	/* è¡¨æ ¼å¯¬åº¦æ§åˆ¶ */
	.table {
		table-layout: fixed;
		width: 100%;
	}

		.table td {
			word-wrap: break-word;
			overflow-wrap: break-word;
			max-width: 0;
		}

			/* æ¨™é¡Œæ¬„ä½ç‰¹åˆ¥è™•ç† */
			.table td:nth-child(2) {
				max-width: 250px;
			}

				.table td:nth-child(2) strong {
					display: block;
					font-weight: 600;
					margin-bottom: 4px;
					overflow: hidden;
					text-overflow: ellipsis;
					white-space: nowrap;
				}

	/* é˜²æ­¢è¡¨æ ¼è¢«æ’å¤§ */
	.table-responsive {
		overflow-x: auto;
	}

	@@media (max-width: 768px) {
		.table td:nth-child(2) {
			max-width: 150px;
		}

		.announcement-content-preview {
			max-width: 120px;
			-webkit-line-clamp: 1;
			max-height: 1.5em;
		}
	}
</style>