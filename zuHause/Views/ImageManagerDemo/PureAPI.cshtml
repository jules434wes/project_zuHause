@{
    ViewData["Title"] = ViewBag.Title ?? "ç´” API æ–¹å¼æ¼”ç¤º";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="demo-page">
    <!-- é é¢æ¨™é¡Œ -->
    <div class="demo-header bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb bg-transparent">
                            <li class="breadcrumb-item">
                                <a href="@Url.Action("Index")" class="text-white">
                                    <i class="fas fa-home me-1"></i>æ¼”ç¤ºé¦–é 
                                </a>
                            </li>
                            <li class="breadcrumb-item active text-white" aria-current="page">
                                ç´” API æ–¹å¼
                            </li>
                        </ol>
                    </nav>
                    
                    <h1 class="display-5 mb-3">
                        <i class="fas fa-code me-3"></i>ç´” API æ–¹å¼
                    </h1>
                    <p class="lead mb-4">
                        @(ViewBag.Description ?? "å®Œå…¨ä½¿ç”¨ JavaScript + REST APIï¼Œé©åˆç¾ä»£å‰ç«¯æ¡†æ¶")
                    </p>
                    
                    <div class="alert alert-info d-inline-block">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>é€šç”¨æ¸¬è©¦æ¨¡çµ„ï¼š</strong>æ”¯æ´è‡ªé¸å¯¦é«”é¡å‹å’Œ IDï¼Œé©ç”¨æ–¼ä»»ä½•æ¥­å‹™å ´æ™¯
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <!-- æ¶æ§‹èªªæ˜ -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-rocket me-2"></i>ç¾ä»£åŒ–æ¶æ§‹å„ªå‹¢
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="text-dark">ğŸ—ï¸ æŠ€è¡“æ¶æ§‹</h5>
                                <div class="architecture-flow">
                                    <div class="flow-step">
                                        <span class="badge bg-primary">å‰ç«¯ JavaScript</span>
                                        <div class="flow-arrow">â¬‡ï¸</div>
                                    </div>
                                    <div class="flow-step">
                                        <span class="badge bg-success">HTTP API å‘¼å«</span>
                                        <div class="flow-arrow">â¬‡ï¸</div>
                                    </div>
                                    <div class="flow-step">
                                        <span class="badge bg-info">JSON è³‡æ–™äº¤æ›</span>
                                        <div class="flow-arrow">â¬‡ï¸</div>
                                    </div>
                                    <div class="flow-step">
                                        <span class="badge bg-warning">å‹•æ…‹ UI æ›´æ–°</span>
                                    </div>
                                </div>
                                
                                <div class="api-features mt-3">
                                    <h6 class="text-primary">ğŸš€ ç¾ä»£åŒ–ç‰¹è‰²</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-bolt text-warning me-2"></i>å³æ™‚éŸ¿æ‡‰</li>
                                        <li><i class="fas fa-mobile-alt text-info me-2"></i>è·¨å¹³å°æ”¯æ´</li>
                                        <li><i class="fas fa-cogs text-secondary me-2"></i>å®Œå…¨å®¢è£½åŒ–</li>
                                        <li><i class="fab fa-js text-success me-2"></i>ç¾ä»£æ¡†æ¶æ•´åˆ</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5 class="text-dark">ğŸ“ API ç«¯é»</h5>
                                <div class="api-endpoints">
                                    <div class="endpoint-item">
                                        <span class="method method-get">GET</span>
                                        <code>/api/ImageManagerApi/list</code>
                                    </div>
                                    <div class="endpoint-item">
                                        <span class="method method-post">POST</span>
                                        <code>/api/ImageManagerApi/upload</code>
                                    </div>
                                    <div class="endpoint-item">
                                        <span class="method method-delete">DELETE</span>
                                        <code>/api/ImageManagerApi/delete/{id}</code>
                                    </div>
                                    <div class="endpoint-item">
                                        <span class="method method-post">POST</span>
                                        <code>/api/ImageManagerApi/reorder</code>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <h6 class="text-primary">ğŸ”§ æ”¯æ´æ¡†æ¶</h6>
                                    <div class="framework-badges">
                                        <span class="badge bg-info me-1">React</span>
                                        <span class="badge bg-success me-1">Vue.js</span>
                                        <span class="badge bg-danger me-1">Angular</span>
                                        <span class="badge bg-primary me-1">React Native</span>
                                        <span class="badge bg-secondary me-1">ç´” JavaScript</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯¦é«”é¸æ“‡é…ç½® -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h3 class="mb-0">
                            <i class="fas fa-cog me-2"></i>æ¸¬è©¦é…ç½®
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label for="entityTypeSelect" class="form-label">
                                    <i class="fas fa-cube me-1"></i>å¯¦é«”é¡å‹
                                </label>
                                <select id="entityTypeSelect" class="form-select" onchange="updateConfig()">
                                    @foreach (var entityType in ViewBag.EntityTypes)
                                    {
                                        if (entityType.Value == ViewBag.DefaultEntityType)
                                        {
                                            <option value="@entityType.Value" selected>@entityType.Text</option>
                                        }
                                        else
                                        {
                                            <option value="@entityType.Value">@entityType.Text</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="entityIdInput" class="form-label">
                                    <i class="fas fa-hashtag me-1"></i>å¯¦é«” ID
                                </label>
                                <input type="number" id="entityIdInput" class="form-control" 
                                       value="@ViewBag.DefaultEntityId" min="1" onchange="updateConfig()">
                            </div>
                            <div class="col-md-3">
                                <label for="categorySelect" class="form-label">
                                    <i class="fas fa-tags me-1"></i>åœ–ç‰‡åˆ†é¡
                                </label>
                                <select id="categorySelect" class="form-select" onchange="updateConfig()">
                                    <option value="0">Gallery (å±•ç¤º)</option>
                                    <option value="1">Profile (å€‹äººè³‡æ–™)</option>
                                    <option value="2">Thumbnail (ç¸®åœ–)</option>
                                    <option value="3">Document (æ–‡ä»¶)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">
                                    <i class="fas fa-shield-alt me-1"></i>é©—è­‰è¨­å®š
                                </label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="skipValidationCheck" onchange="updateConfig()">
                                    <label class="form-check-label" for="skipValidationCheck">
                                        ç•¥éå¯¦é«”é©—è­‰
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="alert alert-light mb-0">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    ç•¶å‰æ¸¬è©¦ç›®æ¨™ï¼š<span id="currentTarget"></span>
                                    <span id="validationStatus" class="badge bg-secondary ms-2"></span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API æ¸¬è©¦å·¥å…· -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-flask me-2"></i>å³æ™‚ API æ¸¬è©¦å·¥å…·
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-list me-2"></i>å–å¾—åœ–ç‰‡æ¸…å–®
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <button class="btn btn-success w-100" onclick="testGetImages()">
                                            <i class="fas fa-download me-2"></i>GET /api/ImageManagerApi/List
                                        </button>
                                        <small class="text-muted mt-2 d-block">å–å¾—æŒ‡å®šå¯¦é«”çš„æ‰€æœ‰åœ–ç‰‡</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-upload me-2"></i>ä¸Šå‚³åœ–ç‰‡
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <input type="file" id="apiTestFiles" class="form-control mb-2" multiple accept="image/*">
                                        <button class="btn btn-info w-100" onclick="testUploadImages()">
                                            <i class="fas fa-cloud-upload-alt me-2"></i>POST /api/ImageManagerApi/Upload
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="card border-warning">
                                    <div class="card-header bg-warning text-dark">
                                        <h5 class="mb-0">
                                            <i class="fas fa-sort me-2"></i>æ›´æ–°æ’åº
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <button class="btn btn-warning w-100" onclick="testReorderImages()">
                                            <i class="fas fa-random me-2"></i>PUT /api/ImageManagerApi/Reorder
                                        </button>
                                        <small class="text-muted mt-2 d-block">éš¨æ©Ÿé‡æ–°æ’åºç¾æœ‰åœ–ç‰‡</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- API å›æ‡‰é¡¯ç¤º -->
                        <div class="mt-4">
                            <h5>
                                <i class="fas fa-terminal me-2"></i>API å›æ‡‰
                            </h5>
                            <div id="apiResponse" class="api-response">
                                <p class="text-muted">é»æ“Šä¸Šæ–¹æŒ‰éˆ•æ¸¬è©¦ APIï¼Œå›æ‡‰å°‡åœ¨é€™è£¡é¡¯ç¤º...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tag Helper åœ–ç‰‡ç®¡ç†å™¨æ¼”ç¤º -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-magic me-2"></i>Tag Helper åœ–ç‰‡ç®¡ç†å™¨
                            <span class="badge bg-light text-dark ms-2">çµ±ä¸€çµ„ä»¶</span>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success" role="alert">
                            <i class="fas fa-rocket me-2"></i>
                            <strong>ç”Ÿç”¢ç´šçµ„ä»¶ï¼š</strong>
                            ä½¿ç”¨çµ±ä¸€åœ–ç‰‡ç®¡ç†çµ„ä»¶ï¼Œæ”¯æ´æ‹–æ‹½æ’åºã€ä¸»åœ–è¨­å®šã€å³æ™‚é è¦½ç­‰å®Œæ•´åŠŸèƒ½ã€‚
                        </div>

                        <!-- å¯¦é«”åƒæ•¸é¸æ“‡ -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <label class="form-label">å¯¦é«”é¡å‹</label>
                                <select class="form-select" id="entityTypeSelect">
                                    <option value="1" selected>Property (æˆ¿æº)</option>
                                    <option value="2">Member (æœƒå“¡)</option>
                                    <option value="3">Furniture (å®¶å…·)</option>
                                    <option value="4">Announcement (å…¬å‘Š)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">å¯¦é«” ID</label>
                                <input type="number" class="form-control" id="entityIdInput" value="2006" min="1">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">åœ–ç‰‡åˆ†é¡</label>
                                <select class="form-select" id="categorySelect">
                                    <option value="1" selected>Gallery (ç›¸ç°¿)</option>
                                    <option value="2">Avatar (é ­åƒ)</option>
                                    <option value="3">Product (ç”¢å“)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">æ“ä½œ</label>
                                <button class="btn btn-primary w-100" onclick="updateImageManager()">
                                    <i class="fas fa-sync me-1"></i>å¥—ç”¨è¨­å®š
                                </button>
                            </div>
                        </div>

                        <!-- Tag Helper åœ–ç‰‡ç®¡ç†å™¨ -->
                        <div id="imageManagerContainer">
                            <zh-image-manager entity-type="Property" entity-id="2006" category="Gallery" max-count="15"></zh-image-manager>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è‡ªå»ºåœ–ç‰‡ç®¡ç†å™¨ -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-desktop me-2"></i>ç´” API è‡ªå»ºåœ–ç‰‡ç®¡ç†å™¨
                            <span class="badge bg-warning ms-2">ç´” JavaScript</span>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info" role="alert">
                            <i class="fas fa-code me-2"></i>
                            <strong>åŸå§‹å¯¦ä½œï¼š</strong>
                            ä½¿ç”¨ç´” JavaScript + REST API çš„å®Œæ•´è‡ªå»ºå¯¦ä½œï¼Œå±•ç¤ºå¦‚ä½•ä¸ä¾è³´çµ„ä»¶åº«é€²è¡Œé–‹ç™¼ã€‚
                        </div>

                        <!-- æ§åˆ¶é¢æ¿ -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <label class="form-label">å¯¦é«”é¡å‹</label>
                                <select class="form-select" id="customEntityTypeSelect" onchange="updateConfig()">
                                    <option value="1" selected>Property (æˆ¿æº)</option>
                                    <option value="2">Member (æœƒå“¡)</option>
                                    <option value="3">Furniture (å®¶å…·)</option>
                                    <option value="4">Announcement (å…¬å‘Š)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">å¯¦é«” ID</label>
                                <input type="number" class="form-control" id="customEntityIdInput" value="2006" min="1" onchange="updateConfig()">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">åœ–ç‰‡åˆ†é¡</label>
                                <select class="form-select" id="customCategorySelect" onchange="updateConfig()">
                                    <option value="0" selected>Gallery (å±•ç¤º)</option>
                                    <option value="1">Profile (å€‹äººè³‡æ–™)</option>
                                    <option value="2">Thumbnail (ç¸®åœ–)</option>
                                    <option value="3">Document (æ–‡ä»¶)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">æ“ä½œ</label>
                                <button class="btn btn-success w-100" onclick="loadImages()">
                                    <i class="fas fa-sync me-1"></i>é‡æ–°è¼‰å…¥
                                </button>
                            </div>
                        </div>

                        <!-- ä¸Šå‚³å€åŸŸ -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="upload-section">
                                    <input type="file" id="fileInput" multiple accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                                    <button class="btn btn-primary me-2" onclick="document.getElementById('fileInput').click()">
                                        <i class="fas fa-plus me-1"></i>é¸æ“‡æª”æ¡ˆ
                                    </button>
                                    <button class="btn btn-warning me-2" onclick="toggleBatchMode()">
                                        <i class="fas fa-check-square me-1"></i>æ‰¹é‡æ“ä½œ
                                    </button>
                                    <button class="btn btn-danger" onclick="deleteSelectedImages()" disabled id="deleteSelectedBtn">
                                        <i class="fas fa-trash me-1"></i>åˆªé™¤é¸ä¸­
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- æ‹–æ‹½ä¸Šå‚³å€åŸŸ -->
                        <div id="dropZone" class="drop-zone mb-3" 
                             ondrop="handleDrop(event)" 
                             ondragover="handleDragOver(event)" 
                             ondragleave="handleDragLeave(event)"
                             ondragenter="handleDragOver(event)">
                            <div class="drop-zone-content">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">æ‹–æ‹½æª”æ¡ˆåˆ°é€™è£¡ä¸Šå‚³</h5>
                                <p class="text-muted">æˆ–é»æ“Šã€Œé¸æ“‡æª”æ¡ˆã€æŒ‰éˆ•</p>
                                <small class="text-info">æ”¯æ´å¤šæª”æ¡ˆåŒæ™‚ä¸Šå‚³ï¼ˆJPGã€PNGã€WebPï¼‰</small>
                            </div>
                        </div>

                        <!-- åœ–ç‰‡ç¶²æ ¼ -->
                        <div id="imageGrid" class="image-grid">
                            <!-- åœ–ç‰‡å°‡å‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                        </div>

                        <!-- ç‹€æ…‹è³‡è¨Š -->
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title" id="totalImages">0</h5>
                                        <p class="card-text">ç¸½åœ–ç‰‡æ•¸</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title" id="selectedCount">0</h5>
                                        <p class="card-text">å·²é¸æ“‡</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title" id="loadingStatus">å°±ç·’</h5>
                                        <p class="card-text">ç‹€æ…‹</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä½¿ç”¨èªªæ˜ -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-question-circle me-2"></i>ä½¿ç”¨æ–¹å¼
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="text-primary">
                                    <i class="fas fa-magic me-2"></i>æ™ºèƒ½åŠŸèƒ½
                                </h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-arrows-alt text-info me-2"></i>æ‹–æ‹½èª¿æ•´é †åº</li>
                                    <li><i class="fas fa-star text-warning me-2"></i>é»æ“Šæ˜Ÿè™Ÿè¨­å®šä¸»åœ–</li>
                                    <li><i class="fas fa-file-upload text-success me-2"></i>æ‹–æ”¾æª”æ¡ˆä¸Šå‚³</li>
                                    <li><i class="fas fa-eye text-primary me-2"></i>å³æ™‚é è¦½</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5 class="text-success">
                                    <i class="fas fa-cogs me-2"></i>ç‹€æ…‹èªªæ˜
                                </h5>
                                <ul class="list-unstyled">
                                    <li><span class="badge bg-success me-2">å·²ä¸Šå‚³</span>å·²å„²å­˜åˆ°ç³»çµ±</li>
                                    <li><span class="badge bg-info me-2">å¾…ä¸Šå‚³</span>å°šæœªå„²å­˜</li>
                                    <li><span class="badge bg-warning me-2">â˜…</span>ä¸»åœ–æ¨™è¨˜</li>
                                    <li><span class="badge bg-secondary me-2">#1</span>æ’åºç·¨è™Ÿ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// å‹•æ…‹æ›´æ–° Tag Helper çš„ JavaScript
function updateImageManager() {
    const entityType = document.getElementById('entityTypeSelect').value;
    const entityId = document.getElementById('entityIdInput').value;
    const category = document.getElementById('categorySelect').value;
    
    const container = document.getElementById('imageManagerContainer');
    container.innerHTML = `<zh-image-manager entity-type="${getEntityTypeName(entityType)}" entity-id="${entityId}" category="${getCategoryName(category)}" max-count="15"></zh-image-manager>`;
    
    // é‡æ–°åˆå§‹åŒ– Tag Helper çµ„ä»¶
    if (window.ZhImageManager) {
        const newElement = container.querySelector('.zh-image-manager');
        if (newElement) {
            new window.ZhImageManager(newElement);
        }
    }
}

function getEntityTypeName(value) {
    const types = { '1': 'Property', '2': 'Member', '3': 'Furniture', '4': 'Announcement' };
    return types[value] || 'Property';
}

function getCategoryName(value) {
    const categories = { '1': 'Gallery', '2': 'Avatar', '3': 'Product' };
    return categories[value] || 'Gallery';
}

// API æ¸¬è©¦åŠŸèƒ½
const demoConfig = {
    entityType: 1,
    entityId: 2006,
    category: 0,
    apiBase: '/api/ImageManagerApi'
};

let currentImages = [];
let selectedImages = new Set();
let isLoading = false;
let isBatchMode = false;

// é…ç½®æ›´æ–°å‡½æ•¸
function updateConfig() {
    demoConfig.entityType = parseInt(document.getElementById('customEntityTypeSelect').value);
    demoConfig.entityId = parseInt(document.getElementById('customEntityIdInput').value);
    demoConfig.category = parseInt(document.getElementById('customCategorySelect').value);
    updateStatusCards();
}

// ç‹€æ…‹å¡ç‰‡æ›´æ–°
function updateStatusCards() {
    document.getElementById('totalImages').textContent = currentImages.length;
    document.getElementById('selectedCount').textContent = selectedImages.size;
    document.getElementById('loadingStatus').textContent = isLoading ? 'è¼‰å…¥ä¸­...' : 'å°±ç·’';
}

// æŒ‰éˆ•ç‹€æ…‹æ›´æ–°
function updateButtonStates() {
    const deleteBtn = document.getElementById('deleteSelectedBtn');
    if (deleteBtn) {
        deleteBtn.disabled = selectedImages.size === 0;
    }
}
                            <div class="tab-pane fade show active" id="vanilla-js" role="tabpanel">
                                <div class="code-example">
                                    <h5>ç´” JavaScript å¯¦ä½œ</h5>
                                    <pre><code>class ImageManager {
    constructor(containerId, options = {}) {
        this.container = document.getElementById(containerId);
        this.options = {
            entityType: options.entityType || 1,
            entityId: options.entityId || 7777,
            category: options.category || 3,
            apiBase: '/api/ImageManagerApi'
        };
        this.images = [];
        this.selectedImages = new Set();
        
        this.init();
    }
    
    async init() {
        await this.loadImages();
        this.updateUI();
    }
    
    async loadImages() {
        try {
            const response = await fetch(
                `${this.options.apiBase}/List?` +
                `entityType=${this.options.entityType}&` +
                `entityId=${this.options.entityId}&` +
                `category=${this.options.category}`
            );
            
            if (response.ok) {
                const data = await response.json();
                this.images = data.data || [];
            }
        } catch (error) {
            console.error('è¼‰å…¥åœ–ç‰‡å¤±æ•—:', error);
        }
    }
    
    async uploadFiles(files) {
        const formData = new FormData();
        formData.append('EntityType', this.options.entityType);
        formData.append('EntityId', this.options.entityId);
        formData.append('Category', this.options.category);
        
        Array.from(files).forEach(file => {
            formData.append('Files', file);
        });
        
        try {
            const response = await fetch(`${this.options.apiBase}/Upload`, {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                await this.loadImages();
                this.updateUI();
                return true;
            }
        } catch (error) {
            console.error('ä¸Šå‚³å¤±æ•—:', error);
        }
        return false;
    }
    
    async deleteImage(imageId) {
        try {
            const response = await fetch(`${this.options.apiBase}/Delete/${imageId}`, {
                method: 'DELETE'
            });
            
            if (response.ok) {
                await this.loadImages();
                this.updateUI();
                return true;
            }
        } catch (error) {
            console.error('åˆªé™¤å¤±æ•—:', error);
        }
        return false;
    }
}</code></pre>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="react" role="tabpanel">
                                <div class="code-example">
                                    <h5>React Hook ç¯„ä¾‹</h5>
                                    <pre><code>import React, { useState, useEffect } from 'react';

const useImageManager = (entityType, entityId, category) => {
    const [images, setImages] = useState([]);
    const [loading, setLoading] = useState(false);
    const [selectedImages, setSelectedImages] = useState(new Set());
    
    const loadImages = async () => {
        setLoading(true);
        try {
            const response = await fetch(
                `/api/ImageManagerApi/list?entityType=${entityType}&entityId=${entityId}&category=${category}`
            );
            const data = await response.json();
            setImages(data.data || []);
        } catch (error) {
            console.error('è¼‰å…¥åœ–ç‰‡å¤±æ•—:', error);
        } finally {
            setLoading(false);
        }
    };
    
    const uploadFiles = async (files) => {
        const formData = new FormData();
        formData.append('EntityType', entityType);
        formData.append('EntityId', entityId);
        formData.append('Category', category);
        
        Array.from(files).forEach(file => {
            formData.append('Files', file);
        });
        
        try {
            setLoading(true);
            const response = await fetch('/api/ImageManagerApi/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                await loadImages();
            }
        } catch (error) {
            console.error('ä¸Šå‚³å¤±æ•—:', error);
        } finally {
            setLoading(false);
        }
    };
    
    useEffect(() => {
        loadImages();
    }, [entityType, entityId, category]);
    
    return {
        images,
        loading,
        selectedImages,
        setSelectedImages,
        uploadFiles,
        loadImages
    };
};

// ä½¿ç”¨ç¯„ä¾‹
const ImageManagerComponent = () => {
    const { images, loading, uploadFiles } = useImageManager(1, 7777, 3);
    
    const handleFileUpload = (event) => {
        const files = event.target.files;
        if (files.length > 0) {
            uploadFiles(files);
        }
    };
    
    return (
        &lt;div&gt;
            &lt;input type="file" multiple onChange={handleFileUpload} /&gt;
            {loading && &lt;div&gt;è¼‰å…¥ä¸­...&lt;/div&gt;}
            &lt;div className="image-grid"&gt;
                {images.map(image => (
                    &lt;img key={image.imageId} src={image.thumbnailUrl} alt="" /&gt;
                ))}
            &lt;/div&gt;
        &lt;/div&gt;
    );
};</code></pre>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="vue" role="tabpanel">
                                <div class="code-example">
                                    <h5>Vue 3 Composition API ç¯„ä¾‹</h5>
                                    <pre><code>&lt;template&gt;
  &lt;div class="image-manager"&gt;
    &lt;div class="toolbar"&gt;
      &lt;input 
        type="file" 
        multiple 
        @@change="handleFileUpload" 
        ref="fileInput"
      /&gt;
      &lt;button @@click="loadImages" :disabled="loading"&gt;
        é‡æ–°è¼‰å…¥
      &lt;/button&gt;
    &lt;/div&gt;
    
    &lt;div v-if="loading" class="loading"&gt;è¼‰å…¥ä¸­...&lt;/div&gt;
    
    &lt;div class="image-grid"&gt;
      &lt;div 
        v-for="image in images" 
        :key="image.imageId"
        class="image-item"
        :class="{ selected: selectedImages.has(image.imageId) }"
        @@click="toggleSelection(image.imageId)"
      &gt;
        &lt;img :src="image.thumbnailUrl" :alt="image.originalFileName" /&gt;
        &lt;button @@click.stop="deleteImage(image.imageId)"&gt;åˆªé™¤&lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, reactive, onMounted } from 'vue';

const props = defineProps({
  entityType: { type: Number, default: 1 },
  entityId: { type: Number, required: true },
  category: { type: Number, default: 3 }
});

const images = ref([]);
const loading = ref(false);
const selectedImages = reactive(new Set());
const fileInput = ref(null);

const loadImages = async () => {
  loading.value = true;
  try {
    const response = await fetch(
      `/api/ImageManagerApi/List?entityType=${props.entityType}&entityId=${props.entityId}&category=${props.category}`
    );
    const data = await response.json();
    images.value = data.data || [];
  } catch (error) {
    console.error('è¼‰å…¥åœ–ç‰‡å¤±æ•—:', error);
  } finally {
    loading.value = false;
  }
};

const uploadFiles = async (files) => {
  const formData = new FormData();
  formData.append('EntityType', props.entityType);
  formData.append('EntityId', props.entityId);
  formData.append('Category', props.category);
  
  Array.from(files).forEach(file => {
    formData.append('Files', file);
  });
  
  try {
    loading.value = true;
    const response = await fetch('/api/ImageManagerApi/Upload', {
      method: 'POST',
      body: formData
    });
    
    if (response.ok) {
      await loadImages();
    }
  } catch (error) {
    console.error('ä¸Šå‚³å¤±æ•—:', error);
  } finally {
    loading.value = false;
  }
};

const handleFileUpload = (event) => {
  const files = event.target.files;
  if (files.length > 0) {
    uploadFiles(files);
  }
};

onMounted(() => {
  loadImages();
});
&lt;/script&gt;</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å°èˆªæŒ‰éˆ• -->
        <div class="row mt-5">
            <div class="col-12 text-center">
                <div class="btn-group" role="group">
                    <a href="@Url.Action("Mixed")" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-arrow-left me-2"></i>ä¸Šä¸€å€‹ï¼šæ··åˆæ–¹å¼
                    </a>
                    <a href="@Url.Action("Index")" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-home me-2"></i>å›åˆ°é¦–é 
                    </a>
                    <a href="@Url.Action("Comparison")" class="btn btn-dark btn-lg">
                        æ¯”è¼ƒåˆ†æ
                        <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Modal å…ƒä»¶ -->
<!-- ç¢ºèªå°è©±æ¡† Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">ç¢ºèªæ“ä½œ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirmModalBody">
                ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿ
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" id="confirmModalAction">ç¢ºå®š</button>
            </div>
        </div>
    </div>
</div>

<!-- è­¦å‘Š/é€šçŸ¥ Modal -->
<div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="alertModalLabel">é€šçŸ¥</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="alertModalBody">
                é€™æ˜¯ä¸€å€‹é€šçŸ¥è¨Šæ¯ã€‚
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ç¢ºå®š</button>
            </div>
        </div>
    </div>
</div>

<style>
.demo-page {
    min-height: 100vh;
    background: #f8f9fa;
}

.demo-header {
    padding: 2rem 0;
}

.architecture-flow {
    text-align: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 0.5rem;
    margin: 1rem 0;
}

.flow-step {
    margin: 0.5rem 0;
}

.flow-arrow {
    font-size: 1.2rem;
    margin: 0.25rem 0;
}

.api-endpoints {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 0.5rem;
}

.endpoint-item {
    display: flex;
    align-items: center;
    margin: 0.5rem 0;
    padding: 0.5rem;
    background: white;
    border-radius: 0.25rem;
    border-left: 3px solid #007bff;
}

.method {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: bold;
    margin-right: 0.5rem;
    min-width: 60px;
    text-align: center;
}

.method-get { background: #28a745; color: white; }
.method-post { background: #007bff; color: white; }
.method-put { background: #ffc107; color: black; }
.method-delete { background: #dc3545; color: white; }

.framework-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
}

.api-response {
    background: #212529;
    color: #f8f9fa;
    padding: 1rem;
    border-radius: 0.5rem;
    min-height: 150px;
    max-height: 400px;
    overflow-y: auto;
    font-family: 'Monaco', 'Consolas', monospace;
    font-size: 0.875rem;
    white-space: pre-wrap;
}

.manager-status .row {
    gap: 1rem;
}

.status-card {
    padding: 1rem;
    border-radius: 0.5rem;
    text-align: center;
    transition: transform 0.2s ease;
}

.status-card:hover {
    transform: translateY(-2px);
}

.status-value {
    font-size: 2rem;
    font-weight: bold;
    line-height: 1;
}

.status-label {
    font-size: 0.875rem;
    opacity: 0.9;
}

.manager-toolbar {
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 1rem;
}

.drop-zone {
    border: 2px dashed #dee2e6;
    border-radius: 0.5rem;
    padding: 3rem 1rem;
    text-align: center;
    transition: all 0.3s ease;
    background: #fafafa;
}

.drop-zone:hover,
.drop-zone.dragover {
    border-color: #007bff;
    background: #f0f8ff;
}

.drop-zone-content {
    pointer-events: none;
}

.image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    padding: 1rem 0;
}

.image-item {
    position: relative;
    background: white;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
}

.image-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.image-item.selected {
    border: 3px solid #007bff;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}

.image-item img {
    width: 100%;
    height: 150px;
    object-fit: cover;
}

.image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.image-item:hover .image-overlay {
    opacity: 1;
}

.image-order-badge {
    position: absolute;
    top: 0.5rem;
    left: 0.5rem;
    background: #007bff;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: bold;
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* SortableJS æ‹–æ›³æ¨£å¼ */
.sortable-ghost {
    opacity: 0.5;
    background: #f8f9fa;
    border: 2px dashed #007bff;
}

.sortable-chosen {
    transform: scale(1.05);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}

.sortable-drag {
    transform: rotate(5deg);
    z-index: 9999;
}

.image-grid .image-item {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.code-example {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 0.5rem;
    border-left: 4px solid #343a40;
}

.code-example pre {
    background: #343a40;
    color: #f8f9fa;
    padding: 1rem;
    border-radius: 0.375rem;
    margin: 0.5rem 0;
    overflow-x: auto;
    max-height: 400px;
}

/* é è¦½åŠŸèƒ½æ¨£å¼ */
.preview-container {
    margin-bottom: 1rem;
    border: 2px solid #28a745;
    border-radius: 0.5rem;
    background: #f8fff8;
    padding: 1rem;
    display: none;
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #28a745;
}

.preview-header h5 {
    margin: 0;
    color: #28a745;
}

.preview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
}

.preview-item {
    position: relative;
    background: white;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    border: 2px solid transparent;
}

.preview-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.preview-item.main-image {
    border-color: #ffc107;
    box-shadow: 0 0 0 2px rgba(255,193,7,0.25);
}

.preview-item img {
    width: 100%;
    height: 120px;
    object-fit: cover;
}

.preview-badge {
    position: absolute;
    top: 0.5rem;
    left: 0.5rem;
    background: #28a745;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: bold;
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.preview-item.main-image .preview-badge {
    background: #ffc107;
    color: #000;
}

.preview-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.preview-item:hover .preview-overlay {
    opacity: 1;
}

.preview-info {
    padding: 0.5rem;
    background: white;
}

.preview-info small {
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

@@media (max-width: 768px) {
    .demo-header {
        padding: 1rem 0;
    }
    
    .btn-group {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .btn-group .btn {
        width: 100%;
    }
    
    .manager-status .row {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .image-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    
    .manager-toolbar .btn-group {
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
    }
}
</style>

<!-- SortableJS CDN å¼•å…¥ -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
// å…¨åŸŸè®Šæ•¸
let currentImages = [];        // å·²ä¸Šå‚³çš„åœ–ç‰‡ï¼ˆä¾†è‡ªAPIï¼‰
let selectedImages = new Set();
let isLoading = false;

// é è¦½ç›¸é—œè®Šæ•¸
let previewFiles = [];         // å¾…ä¸Šå‚³çš„æª”æ¡ˆ
let previewImages = [];        // é è¦½åœ–ç‰‡è³‡æ–™
let mainImageIndex = 0;        // ä¸»åœ–ç´¢å¼•

// æ¼”ç¤ºè¨­å®š - æ”¯æ´å‹•æ…‹é…ç½®
const demoConfig = {
    entityType: @ViewBag.DefaultEntityType,
    entityId: @ViewBag.DefaultEntityId,
    category: @ViewBag.DefaultCategory,
    skipEntityValidation: false,
    apiBase: '/api/ImageManagerApi'
};

// é…ç½®æ›´æ–°å‡½æ•¸
function updateConfig() {
    const entityTypeSelect = document.getElementById('entityTypeSelect');
    const entityIdInput = document.getElementById('entityIdInput');
    const categorySelect = document.getElementById('categorySelect');
    const skipValidationCheck = document.getElementById('skipValidationCheck');
    
    demoConfig.entityType = parseInt(entityTypeSelect.value);
    demoConfig.entityId = parseInt(entityIdInput.value);
    demoConfig.category = parseInt(categorySelect.value);
    demoConfig.skipEntityValidation = skipValidationCheck.checked;
    
    // æ›´æ–°é¡¯ç¤º
    updateCurrentTargetDisplay();
    
    // é‡æ–°è¼‰å…¥åœ–ç‰‡
    loadImages();
}

function updateCurrentTargetDisplay() {
    const entityTypeNames = {
        0: 'Member',
        1: 'Property', 
        2: 'Furniture',
        3: 'Announcement'
    };
    
    const categoryNames = {
        0: 'Gallery',
        1: 'Profile',
        2: 'Thumbnail', 
        3: 'Document'
    };
    
    const entityTypeName = entityTypeNames[demoConfig.entityType] || 'Unknown';
    const categoryName = categoryNames[demoConfig.category] || 'Unknown';
    
    document.getElementById('currentTarget').textContent = 
        `${entityTypeName} ID: ${demoConfig.entityId} (${categoryName})`;
        
    document.getElementById('validationStatus').textContent = 
        demoConfig.skipEntityValidation ? 'ç•¥éé©—è­‰' : 'é©—è­‰é–‹å•Ÿ';
    document.getElementById('validationStatus').className = 
        `badge ${demoConfig.skipEntityValidation ? 'bg-warning' : 'bg-success'} ms-2`;
}

// é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    initPureAPIDemo();
});

function initPureAPIDemo() {
    updateCurrentTargetDisplay();
    loadImages();
    initSortable();
    logApiCall('åˆå§‹åŒ–', 'ç´” API æ¨¡å¼å·²å•Ÿå‹•');
}

// API æ¸¬è©¦å‡½æ•¸
async function testGetImages() {
    const url = `${demoConfig.apiBase}/list?entityType=${demoConfig.entityType}&entityId=${demoConfig.entityId}&category=${demoConfig.category}`;
    
    logApiCall('GET', url);
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        
        logApiCall('å›æ‡‰', JSON.stringify(data, null, 2));
        
        if (data.Success) {
            currentImages = data.Data?.Images || [];
            updateImageGrid();
            updateStatusCards();
        }
    } catch (error) {
        logApiCall('éŒ¯èª¤', error.message);
    }
}

async function testUploadImages() {
    const fileInput = document.getElementById('apiTestFiles');
    const files = fileInput.files;
    
    if (files.length === 0) {
        await showAlert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ', 'æç¤º');
        return;
    }
    
    const formData = new FormData();
    formData.append('EntityType', demoConfig.entityType);
    formData.append('EntityId', demoConfig.entityId);
    formData.append('Category', demoConfig.category);
    formData.append('SkipEntityValidation', demoConfig.skipEntityValidation);
    
    Array.from(files).forEach(file => {
        formData.append('Files', file);
    });
    
    const url = `${demoConfig.apiBase}/upload`;
    logApiCall('POST', url);
    logApiCall('FormData', `æª”æ¡ˆæ•¸é‡: ${files.length}`);
    
    try {
        const response = await fetch(url, {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        logApiCall('å›æ‡‰', JSON.stringify(data, null, 2));
        
        if (data.Success) {
            // é‡æ–°è¼‰å…¥åœ–ç‰‡æ¸…å–®
            await testGetImages();
            fileInput.value = ''; // æ¸…ç©ºé¸æ“‡
            await showAlert('ä¸Šå‚³æˆåŠŸï¼', 'æˆåŠŸ');
        } else {
            // é¡¯ç¤ºå…·é«”çš„éŒ¯èª¤è¨Šæ¯
            const errorMessage = data.message || 'ä¸Šå‚³å¤±æ•—';
            const details = data.errors?.length > 0 ? data.errors.join('\n') : '';
            await showAlert(errorMessage + (details ? '\n\nè©³ç´°éŒ¯èª¤ï¼š\n' + details : ''), 'éŒ¯èª¤');
        }
    } catch (error) {
        logApiCall('éŒ¯èª¤', error.message);
        await showAlert('ç¶²è·¯éŒ¯èª¤æˆ–ä¼ºæœå™¨ç„¡å›æ‡‰ï¼š' + error.message, 'éŒ¯èª¤');
    }
}

async function testReorderImages() {
    if (currentImages.length === 0) {
        await showAlert('æ²’æœ‰åœ–ç‰‡å¯ä»¥æ’åºï¼Œè«‹å…ˆä¸Šå‚³ä¸€äº›åœ–ç‰‡', 'æç¤º');
        return;
    }
    
    // éš¨æ©Ÿé‡æ–°æ’åº
    const shuffled = [...currentImages].sort(() => Math.random() - 0.5);
    const reorderData = shuffled.map((img, index) => ({
        imageId: img.ImageId,
        displayOrder: index + 1
    }));
    
    const url = `${demoConfig.apiBase}/reorder`;
    logApiCall('POST', url);
    logApiCall('è«‹æ±‚è³‡æ–™', JSON.stringify(reorderData, null, 2));
    
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(reorderData)
        });
        
        const data = await response.json();
        logApiCall('å›æ‡‰', JSON.stringify(data, null, 2));
        
        if (data.Success) {
            await testGetImages(); // é‡æ–°è¼‰å…¥ä»¥æŸ¥çœ‹æ–°é †åº
        }
    } catch (error) {
        logApiCall('éŒ¯èª¤', error.message);
    }
}

function logApiCall(type, content) {
    const responseDiv = document.getElementById('apiResponse');
    if (!responseDiv) return;
    
    const timestamp = new Date().toLocaleTimeString();
    const entry = `[${timestamp}] ${type}:\n${content}\n\n`;
    responseDiv.textContent += entry;
    responseDiv.scrollTop = responseDiv.scrollHeight;
    
    // ä¿æŒæœ€è¿‘ 50 æ¢è¨˜éŒ„
    const lines = responseDiv.textContent.split('\n');
    if (lines.length > 200) {
        responseDiv.textContent = lines.slice(-100).join('\n');
    }
}

// è‡ªå»ºåœ–ç‰‡ç®¡ç†å™¨åŠŸèƒ½
async function loadImages() {
    if (isLoading) return;
    
    isLoading = true;
    updateStatusCards();
    
    try {
        const response = await fetch(
            `${demoConfig.apiBase}/List?entityType=${demoConfig.entityType}&entityId=${demoConfig.entityId}&category=${demoConfig.category}`
        );
        
        if (response.ok) {
            const data = await response.json();
            currentImages = data.Data?.Images || [];
            
            // ç¢ºä¿åœ–ç‰‡æŒ‰ç…§ displayOrder æ’åº
            currentImages.sort((a, b) => (a.DisplayOrder || 0) - (b.DisplayOrder || 0));
            
            updateImageGrid();
            
            // è‡ªå‹•ä¿®æ­£é †åºï¼ˆå¦‚æœéœ€è¦ï¼‰
            await normalizeDisplayOrder();
        }
    } catch (error) {
        console.error('è¼‰å…¥åœ–ç‰‡å¤±æ•—:', error);
    } finally {
        isLoading = false;
        updateStatusCards();
        updateButtonStates();
    }
}

function updateImageGrid() {
    const grid = document.getElementById('imageGrid');
    if (!grid) return;
    
    if (currentImages.length === 0) {
        grid.innerHTML = `
            <div class="col-12 text-center text-muted p-4">
                <i class="fas fa-images fa-3x mb-3"></i>
                <h5>å°šç„¡åœ–ç‰‡</h5>
                <p>è«‹ä¸Šå‚³ä¸€äº›åœ–ç‰‡ä¾†æ¸¬è©¦åŠŸèƒ½</p>
            </div>
        `;
        return;
    }
    
    grid.innerHTML = currentImages.map((image, index) => `
        <div class="image-item ${selectedImages.has(image.ImageId) ? 'selected' : ''}" 
             data-image-id="${image.ImageId}"
             onclick="toggleImageSelection(${image.ImageId})">
            <div class="image-order-badge">${index + 1}</div>
            <img src="${image.ThumbnailUrl || image.OriginalUrl}" 
                 alt="${image.FileName}" 
                 loading="lazy">
            <div class="image-overlay">
                <div class="btn-group">
                    <button class="btn btn-sm btn-light" onclick="event.stopPropagation(); previewImage('${image.OriginalUrl}')">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteImage(${image.ImageId})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="image-info">
                <small class="text-muted">${image.FileName}</small>
            </div>
        </div>
    `).join('');
    
    // é‡æ–°åˆå§‹åŒ– SortableJS (å› ç‚º DOM å·²æ›´æ–°)
    initSortable();
}

// SortableJS åˆå§‹åŒ–å’Œæ’åºåŠŸèƒ½
let sortableInstance = null;

function initSortable() {
    const imageGrid = document.getElementById('imageGrid');
    if (!imageGrid) return;
    
    // å¦‚æœå·²ç¶“æœ‰ sortable å¯¦ä¾‹ï¼Œå…ˆéŠ·æ¯€
    if (sortableInstance) {
        sortableInstance.destroy();
    }
    
    // åªæœ‰ç•¶æœ‰åœ–ç‰‡æ™‚æ‰åˆå§‹åŒ–æ’åº
    if (currentImages.length > 0) {
        sortableInstance = Sortable.create(imageGrid, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            chosenClass: 'sortable-chosen',
            dragClass: 'sortable-drag',
            onEnd: function(evt) {
                // æ›´æ–°åœ–ç‰‡é †åº
                const oldIndex = evt.oldIndex;
                const newIndex = evt.newIndex;
                
                if (oldIndex !== newIndex) {
                    // é‡æ–°æ’åˆ— currentImages é™£åˆ—
                    const movedImage = currentImages.splice(oldIndex, 1)[0];
                    currentImages.splice(newIndex, 0, movedImage);
                    
                    // æ›´æ–°é¡¯ç¤ºçš„é †åºè™Ÿç¢¼
                    updateImageGrid();
                    
                    // å‘¼å« API æ›´æ–°æ’åº
                    updateImageOrder();
                }
            }
        });
    }
}

async function updateImageOrder() {
    try {
        const orderData = currentImages.map((image, index) => ({
            imageId: image.ImageId,
            displayOrder: index + 1
        }));
        
        const response = await fetch(`${demoConfig.apiBase}/reorder`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(orderData)
        });
        
        if (response.ok) {
            logApiCall('æˆåŠŸ', `åœ–ç‰‡æ’åºå·²æ›´æ–°`);
        } else {
            throw new Error(`æ’åºæ›´æ–°å¤±æ•—: ${response.statusText}`);
        }
    } catch (error) {
        console.error('æ›´æ–°æ’åºå¤±æ•—:', error);
        logApiCall('éŒ¯èª¤', `æ’åºæ›´æ–°å¤±æ•—: ${error.message}`);
        // é‡æ–°è¼‰å…¥åœ–ç‰‡ä»¥é‚„åŸæ­£ç¢ºé †åº
        await loadImages();
    }
}

// è‡ªå‹•ä¿®æ­£é †åºé‚è¼¯
async function normalizeDisplayOrder() {
    if (currentImages.length === 0) return;
    
    // æª¢æŸ¥æ˜¯å¦éœ€è¦é‡æ–°æ’åº
    const needsReorder = currentImages.some((image, index) => 
        (image.DisplayOrder || 0) !== (index + 1)
    );
    
    if (needsReorder) {
        console.log('åµæ¸¬åˆ°é †åºéœ€è¦ä¿®æ­£ï¼Œæ­£åœ¨è‡ªå‹•ä¿®æ­£...');
        
        // æ›´æ–°æœ¬åœ°é †åº
        currentImages.forEach((image, index) => {
            image.DisplayOrder = index + 1;
        });
        
        // åŒæ­¥åˆ°å¾Œç«¯
        await updateImageOrder();
        
        console.log('é †åºä¿®æ­£å®Œæˆ');
    }
}

function updateStatusCards() {
    const total = currentImages.length;
    const uploaded = currentImages.filter(img => img.isUploaded !== false).length;
    const selected = selectedImages.size;
    const loading = isLoading ? 1 : 0;
    
    document.getElementById('totalCount').textContent = total;
    document.getElementById('uploadedCount').textContent = uploaded;
    document.getElementById('selectedCount').textContent = selected;
    document.getElementById('loadingCount').textContent = loading;
}

function updateButtonStates() {
    const uploadBtn = document.getElementById('uploadBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    
    if (uploadBtn) {
        uploadBtn.disabled = isLoading;
    }
    
    if (deleteBtn) {
        deleteBtn.disabled = selectedImages.size === 0 || isLoading;
    }
}

function selectFiles() {
    document.getElementById('fileInput').click();
}

function handleFileSelect(event) {
    const files = event.target.files;
    if (files.length > 0) {
        addFilesToPreview(files);
    }
}

// ä¿ç•™èˆŠçš„ç›´æ¥ä¸Šå‚³å‡½æ•¸ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
async function uploadFiles(files) {
    if (isLoading) return;
    
    const formData = new FormData();
    formData.append('EntityType', demoConfig.entityType);
    formData.append('EntityId', demoConfig.entityId);
    formData.append('Category', demoConfig.category);
    formData.append('SkipEntityValidation', demoConfig.skipEntityValidation);
    
    Array.from(files).forEach(file => {
        formData.append('Files', file);
    });
    
    isLoading = true;
    updateStatusCards();
    
    try {
        const response = await fetch(`${demoConfig.apiBase}/upload`, {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            const data = await response.json();
            if (data.Success) {
                await loadImages();
                document.getElementById('fileInput').value = '';
                logApiCall('ä¸Šå‚³æˆåŠŸ', `æˆåŠŸä¸Šå‚³ ${files.length} å€‹æª”æ¡ˆ`);
                await showAlert('ä¸Šå‚³æˆåŠŸï¼', 'æˆåŠŸ');
            } else {
                const errorMessage = data.Message || 'ä¸Šå‚³å¤±æ•—';
                const details = data.Errors?.length > 0 ? data.Errors.join('\n') : '';
                logApiCall('ä¸Šå‚³å¤±æ•—', errorMessage + (details ? '\nè©³ç´°ï¼š' + details : ''));
                await showAlert(errorMessage + (details ? '\n\nè©³ç´°éŒ¯èª¤ï¼š\n' + details : ''), 'éŒ¯èª¤');
            }
        } else {
            const errorText = await response.text();
            logApiCall('HTTP éŒ¯èª¤', `${response.status}: ${errorText}`);
            await showAlert(`ä¸Šå‚³å¤±æ•— (${response.status}): ${errorText}`, 'éŒ¯èª¤');
        }
    } catch (error) {
        console.error('ä¸Šå‚³å¤±æ•—:', error);
        await showAlert('ä¸Šå‚³å¤±æ•—: ' + error.message, 'éŒ¯èª¤');
    } finally {
        isLoading = false;
        updateStatusCards();
        updateButtonStates();
    }
}

function toggleImageSelection(imageId) {
    if (selectedImages.has(imageId)) {
        selectedImages.delete(imageId);
    } else {
        selectedImages.add(imageId);
    }
    
    updateImageGrid();
    updateStatusCards();
    updateButtonStates();
}

function selectAll() {
    selectedImages.clear();
    currentImages.forEach(img => selectedImages.add(img.ImageId));
    updateImageGrid();
    updateStatusCards();
    updateButtonStates();
}

function selectNone() {
    selectedImages.clear();
    updateImageGrid();
    updateStatusCards();
    updateButtonStates();
}

async function deleteSelected() {
    if (selectedImages.size === 0) return;
    
    const confirmed = await showConfirm(`ç¢ºå®šè¦åˆªé™¤ ${selectedImages.size} å¼µåœ–ç‰‡å—ï¼Ÿ`, 'åˆªé™¤ç¢ºèª');
    if (!confirmed) {
        return;
    }
    
    isLoading = true;
    updateStatusCards();
    
    try {
        const deletePromises = Array.from(selectedImages).map(imageId =>
            fetch(`${demoConfig.apiBase}/Delete/${imageId}`, { method: 'DELETE' })
        );
        
        await Promise.all(deletePromises);
        selectedImages.clear();
        await loadImages();
    } catch (error) {
        console.error('åˆªé™¤å¤±æ•—:', error);
        await showAlert('åˆªé™¤å¤±æ•—: ' + error.message, 'éŒ¯èª¤');
    } finally {
        isLoading = false;
        updateStatusCards();
        updateButtonStates();
    }
}

async function deleteImage(imageId) {
    const confirmed = await showConfirm('ç¢ºå®šè¦åˆªé™¤é€™å¼µåœ–ç‰‡å—ï¼Ÿ', 'åˆªé™¤ç¢ºèª');
    if (!confirmed) {
        return;
    }
    
    try {
        const response = await fetch(`${demoConfig.apiBase}/Delete/${imageId}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            selectedImages.delete(imageId);
            await loadImages();
        } else {
            await showAlert('åˆªé™¤å¤±æ•—', 'éŒ¯èª¤');
        }
    } catch (error) {
        console.error('åˆªé™¤å¤±æ•—:', error);
        await showAlert('åˆªé™¤å¤±æ•—: ' + error.message, 'éŒ¯èª¤');
    }
}

async function shuffleImages() {
    if (currentImages.length === 0) {
        await showAlert('æ²’æœ‰åœ–ç‰‡å¯ä»¥æ’åº', 'æç¤º');
        return;
    }
    
    // éš¨æ©Ÿé‡æ–°æ’åº currentImages é™£åˆ—
    currentImages.sort(() => Math.random() - 0.5);
    
    // æ›´æ–°é¡¯ç¤º
    updateImageGrid();
    
    // å‘¼å« API æ›´æ–°æ’åº
    updateImageOrder();
}

function refreshImages() {
    loadImages();
}

function previewImage(imagePath) {
    // ç°¡å–®çš„åœ–ç‰‡é è¦½
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 9999; display: flex;
        align-items: center; justify-content: center; cursor: pointer;
    `;
    
    const img = document.createElement('img');
    img.src = imagePath;
    img.style.cssText = 'max-width: 90%; max-height: 90%; object-fit: contain;';
    
    modal.appendChild(img);
    modal.onclick = () => document.body.removeChild(modal);
    document.body.appendChild(modal);
}

// æ‹–æ‹½åŠŸèƒ½ - åŠ å¼·äº‹ä»¶è™•ç†
function handleDragOver(event) {
    event.preventDefault();
    event.stopPropagation();
    event.currentTarget.classList.add('dragover');
}

function handleDragLeave(event) {
    event.preventDefault();
    event.stopPropagation();
    event.currentTarget.classList.remove('dragover');
}

function handleDrop(event) {
    event.preventDefault();
    event.stopPropagation();
    event.currentTarget.classList.remove('dragover');
    
    const files = event.dataTransfer.files;
    if (files.length > 0) {
        console.log('æ‹–æ›³æª”æ¡ˆæ•¸é‡:', files.length);
        addFilesToPreview(files);
    }
}

// æ”¹é€²çš„æ‹–æ›³äº‹ä»¶è™•ç† - é¿å…è¡çª
document.addEventListener('DOMContentLoaded', function() {
    // åªé˜»æ­¢ body å±¤ç´šçš„æ‹–æ›³ï¼Œä¸å½±éŸ¿æ‹–æ›³å€åŸŸ
    document.body.addEventListener('dragover', function(e) {
        if (!e.target.closest('#dropZone')) {
            e.preventDefault();
        }
    });
    
    document.body.addEventListener('drop', function(e) {
        if (!e.target.closest('#dropZone')) {
            e.preventDefault();
        }
    });
    
    console.log('ç´” API æ¨¡å¼æ‹–æ›³é˜²è­·å·²å•Ÿç”¨ï¼ˆæ”¹é€²ç‰ˆï¼‰');
});

function uploadSelected() {
    if (previewImages.length > 0) {
        confirmUploadPreviews();
    } else {
        selectFiles();
    }
}

// === é è¦½åŠŸèƒ½ ===
function addFilesToPreview(files) {
    previewFiles = Array.from(files);
    previewImages = [];
    
    Array.from(files).forEach((file, index) => {
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImages.push({
                    file: file,
                    url: e.target.result,
                    fileName: file.name,
                    size: file.size,
                    isMain: index === mainImageIndex,
                    isUploaded: false
                });
                
                if (previewImages.length === previewFiles.length) {
                    renderPreview();
                }
            };
            reader.readAsDataURL(file);
        }
    });
}

function renderPreview() {
    const previewContainer = document.querySelector('.preview-container');
    const imageGrid = document.getElementById('imageGrid');
    
    if (!previewContainer) {
        // å»ºç«‹é è¦½å®¹å™¨
        const newPreviewContainer = document.createElement('div');
        newPreviewContainer.className = 'preview-container';
        newPreviewContainer.innerHTML = `
            <div class="preview-header">
                <h5><i class="fas fa-eye me-2"></i>å¾…ä¸Šå‚³é è¦½ (${previewImages.length} å¼µ)</h5>
                <div class="btn-group">
                    <button class="btn btn-success btn-sm" onclick="confirmUploadPreviews()">
                        <i class="fas fa-upload me-1"></i>ç¢ºèªä¸Šå‚³
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="clearPreview()">
                        <i class="fas fa-times me-1"></i>å–æ¶ˆ
                    </button>
                </div>
            </div>
            <div class="preview-grid" id="previewGrid"></div>
        `;
        imageGrid.parentNode.insertBefore(newPreviewContainer, imageGrid);
    }
    
    // é¡¯ç¤ºé è¦½
    const container = document.querySelector('.preview-container');
    const grid = document.getElementById('previewGrid');
    
    if (previewImages.length > 0) {
        container.style.display = 'block';
        grid.innerHTML = previewImages.map((image, index) => `
            <div class="preview-item ${image.isMain ? 'main-image' : ''}" 
                 onclick="setMainImage(${index})">
                <div class="preview-badge">${image.isMain ? 'â˜…' : index + 1}</div>
                <img src="${image.url}" alt="${image.fileName}">
                <div class="preview-overlay">
                    <div class="btn-group">
                        <button class="btn btn-sm btn-warning" onclick="event.stopPropagation(); setMainImage(${index})">
                            <i class="fas fa-star"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); removePreviewImage(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="preview-info">
                    <small class="text-muted">${image.fileName}</small>
                    <small class="text-info d-block">${(image.size / 1024).toFixed(1)} KB</small>
                </div>
            </div>
        `).join('');
    } else {
        container.style.display = 'none';
    }
    
    updateStatusCards();
}

function setMainImage(index) {
    previewImages.forEach((img, i) => {
        img.isMain = (i === index);
    });
    mainImageIndex = index;
    renderPreview();
}

function removePreviewImage(index) {
    previewImages.splice(index, 1);
    previewFiles.splice(index, 1);
    
    if (mainImageIndex >= index && mainImageIndex > 0) {
        mainImageIndex--;
    }
    
    if (previewImages.length > 0 && mainImageIndex >= previewImages.length) {
        mainImageIndex = previewImages.length - 1;
    }
    
    // æ›´æ–°ä¸»åœ–æ¨™è¨˜
    if (previewImages.length > 0) {
        previewImages.forEach((img, i) => {
            img.isMain = (i === mainImageIndex);
        });
    }
    
    renderPreview();
}

function clearPreview() {
    previewFiles = [];
    previewImages = [];
    mainImageIndex = 0;
    
    const container = document.querySelector('.preview-container');
    if (container) {
        container.style.display = 'none';
    }
    
    // æ¸…ç©ºæª”æ¡ˆè¼¸å…¥
    const fileInput = document.getElementById('fileInput');
    if (fileInput) {
        fileInput.value = '';
    }
    
    updateStatusCards();
}

async function confirmUploadPreviews() {
    if (previewFiles.length === 0) {
        await showAlert('æ²’æœ‰æª”æ¡ˆå¯ä»¥ä¸Šå‚³', 'æç¤º');
        return;
    }
    
    // ä½¿ç”¨ç¾æœ‰çš„ä¸Šå‚³åŠŸèƒ½
    await uploadFiles(previewFiles);
    
    // æ¸…ç©ºé è¦½
    clearPreview();
}

// ç‹€æ…‹æ›´æ–°å‡½æ•¸è£œå®Œ
function updateStatusCards() {
    const totalElement = document.getElementById('totalImages');
    const selectedElement = document.getElementById('selectedCount');
    const loadingElement = document.getElementById('loadingStatus');
    
    if (totalElement) {
        totalElement.textContent = currentImages.length + (previewImages.length || 0);
    }
    
    if (selectedElement) {
        selectedElement.textContent = selectedImages.size;
    }
    
    if (loadingElement) {
        loadingElement.textContent = isLoading ? 'è¼‰å…¥ä¸­...' : 'å°±ç·’';
    }
}

// æ‰¹é‡æ“ä½œåŠŸèƒ½
let isBatchMode = false;

function toggleBatchMode() {
    isBatchMode = !isBatchMode;
    const toggleBtn = document.querySelector('button[onclick="toggleBatchMode()"]');
    const deleteBtn = document.getElementById('deleteSelectedBtn');
    
    if (toggleBtn) {
        toggleBtn.innerHTML = isBatchMode 
            ? '<i class="fas fa-check-square me-1"></i>é€€å‡ºæ‰¹é‡'
            : '<i class="fas fa-check-square me-1"></i>æ‰¹é‡æ“ä½œ';
        toggleBtn.className = isBatchMode ? 'btn btn-secondary me-2' : 'btn btn-warning me-2';
    }
    
    if (deleteBtn) {
        deleteBtn.style.display = isBatchMode ? 'inline-block' : 'none';
    }
    
    if (!isBatchMode) {
        selectedImages.clear();
        updateImageGrid();
        updateStatusCards();
    }
}

function deleteSelectedImages() {
    if (selectedImages.size === 0) {
        showAlert('è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„åœ–ç‰‡', 'æç¤º');
        return;
    }
    
    deleteSelected();
}

// Modal å°è©±æ¡†åŠŸèƒ½
function showAlert(message, title = 'æç¤º') {
    return new Promise((resolve) => {
        const modal = document.getElementById('alertModal');
        const titleElement = document.getElementById('alertModalLabel');
        const bodyElement = document.getElementById('alertModalBody');
        
        if (titleElement) titleElement.textContent = title;
        if (bodyElement) bodyElement.textContent = message;
        
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
        
        modal.addEventListener('hidden.bs.modal', () => resolve(), { once: true });
    });
}

function showConfirm(message, title = 'ç¢ºèª') {
    return new Promise((resolve) => {
        const modal = document.getElementById('confirmModal');
        const titleElement = document.getElementById('confirmModalLabel');
        const bodyElement = document.getElementById('confirmModalBody');
        const actionBtn = document.getElementById('confirmModalAction');
        
        if (titleElement) titleElement.textContent = title;
        if (bodyElement) bodyElement.textContent = message;
        
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
        
        let resolved = false;
        
        const handleConfirm = () => {
            if (!resolved) {
                resolved = true;
                resolve(true);
                bootstrapModal.hide();
            }
        };
        
        const handleCancel = () => {
            if (!resolved) {
                resolved = true;
                resolve(false);
                bootstrapModal.hide();
            }
        };
        
        actionBtn.onclick = handleConfirm;
        modal.addEventListener('hidden.bs.modal', handleCancel, { once: true });
    });
}

// é è¦½æ’åºåŠŸèƒ½
function initPreviewSortable() {
    const previewGrid = document.getElementById('previewGrid');
    if (!previewGrid || previewImages.length === 0) return;
    
    new Sortable(previewGrid, {
        animation: 150,
        ghostClass: 'sortable-ghost',
        chosenClass: 'sortable-chosen',
        onEnd: function(evt) {
            // é‡æ–°æ’åˆ—é è¦½åœ–ç‰‡é™£åˆ—
            const movedItem = previewImages.splice(evt.oldIndex, 1)[0];
            previewImages.splice(evt.newIndex, 0, movedItem);
            
            const movedFile = previewFiles.splice(evt.oldIndex, 1)[0];
            previewFiles.splice(evt.newIndex, 0, movedFile);
            
            updatePreviewDisplay();
        }
    });
}

function clearPreviews() {
    previewImages = [];
    previewFiles = [];
    
    const container = document.getElementById('previewContainer');
    if (container) {
        container.style.display = 'none';
    }
    
    // æ¸…ç©ºæª”æ¡ˆè¼¸å…¥
    document.getElementById('fileInput').value = '';
    updateStatusCards();
}

function removeFromPreview(index) {
    previewImages.splice(index, 1);
    previewFiles.splice(index, 1);
    
    // å¦‚æœåˆªé™¤çš„æ˜¯ä¸»åœ–ä¸”é‚„æœ‰å…¶ä»–åœ–ç‰‡ï¼Œè¨­å®šç¬¬ä¸€å¼µç‚ºä¸»åœ–
    if (previewImages.length > 0 && !previewImages.some(img => img.isMainImage)) {
        previewImages[0].isMainImage = true;
    }
    
    updatePreviewDisplay();
    updateStatusCards();
}
        }, { once: true });
        
        modal.show();
    });
}

function showAlert(message, title = 'é€šçŸ¥') {
    return new Promise((resolve) => {
        const modal = new bootstrap.Modal(document.getElementById('alertModal'));
        document.getElementById('alertModalLabel').textContent = title;
        document.getElementById('alertModalBody').textContent = message;
        
        // ç›£è½é—œé–‰
        const modalElement = document.getElementById('alertModal');
        modalElement.addEventListener('hidden.bs.modal', () => {
            resolve();
        }, { once: true });
        
        modal.show();
    });
}
</script>